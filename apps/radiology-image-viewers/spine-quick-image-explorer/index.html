<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Radiology Visuals – Spine Quick Image Explorer</title>
  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --panel:#0E1630cc;
      --panel2:#0E1630;
      --card:#0D1430;
      --card2:#101A3A;
      --text:#EAF0FF;
      --muted:#A9B7E6;
      --muted2:#7F8CC2;
      --stroke:#24306A;
      --stroke2:#2F3B7A;
      --glow:#7B5CFF;
      --glow2:#27D6FF;
      --good:#37D67A;
      --warn:#FFCC66;
      --bad:#FF5577;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 0%, rgba(123,92,255,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 12%, rgba(39,214,255,.16), transparent 55%),
        radial-gradient(1000px 800px at 60% 100%, rgba(55,214,122,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    .app{
      height:100%;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:18px;
      padding:18px;
    }

    .left, .right{
      border:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(14,22,48,.65), rgba(14,22,48,.35));
      backdrop-filter: blur(12px);
      border-radius:18px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .header{
      padding:16px 16px 12px 16px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }

    .title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin:0 0 10px 0;
    }

    .title h1{
      margin:0;
      font-size:16px;
      letter-spacing:.3px;
      font-weight:700;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .pill strong{color:var(--text); font-weight:700}

    .controls{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    input[type="text"], select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,15,30,.55);
      color: var(--text);
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.35);
    }
    input[type="text"]::placeholder{color:rgba(233,240,255,.45)}
    select{cursor:pointer}

    .hint{
      margin-top:10px;
      color:var(--muted2);
      font-size:12px;
      line-height:1.35;
    }
    .kbd{
      display:inline-block;
      padding:2px 7px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color:var(--text);
      font-size:11px;
      margin:0 2px;
    }

    .list{
      padding:10px;
      height: calc(100% - 166px);
      overflow:auto;
    }

    .section{
      margin:10px 0 14px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      position:sticky;
      top:0;
      z-index:5;
      backdrop-filter: blur(10px);
    }
    .section h2{
      margin:0;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.35px;
      text-transform:uppercase;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .count{
      font-size:11px;
      color:rgba(233,240,255,.6);
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }

    .card{
      border:1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(13,20,48,.85), rgba(13,20,48,.55));
      border-radius:16px;
      padding:12px 12px;
      margin:10px 0;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
      position:relative;
      overflow:hidden;
    }
    .card:hover{
      transform: translateY(-1px);
      border-color: rgba(123,92,255,.45);
      box-shadow: 0 10px 35px rgba(123,92,255,.12);
    }
    .card.active{
      border-color: rgba(39,214,255,.55);
      box-shadow: 0 12px 40px rgba(39,214,255,.14);
      background: linear-gradient(180deg, rgba(16,26,58,.92), rgba(16,26,58,.60));
    }

    .card .name{
      font-weight:750;
      font-size:13px;
      margin:0 0 6px 0;
      line-height:1.25;
    }
    .card .meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      color:var(--muted);
      font-size:12px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .dot{
      width:7px;height:7px;border-radius:99px;
      background: var(--glow);
      box-shadow: 0 0 14px rgba(123,92,255,.55);
      display:inline-block;
    }
    .dot.cyan{background: var(--glow2); box-shadow:0 0 14px rgba(39,214,255,.55)}
    .dot.green{background: var(--good); box-shadow:0 0 14px rgba(55,214,122,.45)}
    .dot.warn{background: var(--warn); box-shadow:0 0 14px rgba(255,204,102,.45)}
    .dot.bad{background: var(--bad); box-shadow:0 0 14px rgba(255,85,119,.45)}

    .rightTop{
      padding:14px 14px 12px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }

    .nowTitle{
      margin:0;
      font-size:14px;
      font-weight:800;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .nowSub{
      margin:6px 0 0 0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    .btns{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
      min-width: 260px;
    }
    button{
      border:none;
      cursor:pointer;
      color:var(--text);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      padding:9px 10px;
      border-radius:12px;
      font-size:12px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    button:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
    }
    button.primary{
      background: linear-gradient(90deg, rgba(123,92,255,.22), rgba(39,214,255,.18));
      border-color: rgba(39,214,255,.30);
    }
    button.primary:hover{
      border-color: rgba(39,214,255,.55);
      box-shadow: 0 12px 35px rgba(39,214,255,.10);
    }

    .viewerWrap{
      height: calc(100% - 74px);
      position:relative;
      background: rgba(4,6,14,.35);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      background: rgba(0,0,0,.15);
    }

    .overlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      pointer-events:none;
    }
    .overlay .note{
      pointer-events:auto;
      max-width: 860px;
      width: 100%;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,15,30,.78);
      backdrop-filter: blur(12px);
      padding:12px 12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
    }
    .overlay .note .icon{
      width:34px;height:34px;border-radius:12px;
      background: rgba(255,204,102,.12);
      border:1px solid rgba(255,204,102,.25);
      display:flex;align-items:center;justify-content:center;
      color: var(--warn);
      flex:0 0 auto;
    }
    .overlay .note .txt{
      flex:1 1 auto;
      min-width:0;
    }
    .overlay .note .txt .line1{
      font-size:12px;
      font-weight:800;
      margin:0 0 4px 0;
    }
    .overlay .note .txt .line2{
      font-size:12px;
      color: var(--muted);
      margin:0;
      line-height:1.35;
    }
    .overlay .note .noteBtns{
      flex:0 0 auto;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background: rgba(10,15,30,.88);
      border:1px solid rgba(255,255,255,.10);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      box-shadow: var(--shadow);
      font-size:12px;
      opacity:0;
      pointer-events:none;
      transition: opacity .15s ease, transform .15s ease;
      z-index:1000;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-4px);
    }

    .small{
      font-size:11px;
      color:rgba(233,240,255,.55);
    }

    @media (max-width: 980px){
      body{overflow:auto}
      .app{
        height:auto;
        min-height:100%;
        grid-template-columns:1fr;
      }
      .list{height:auto; max-height: 52vh}
      .viewerWrap{height: 62vh}
    }

    /* scrollbar */
    .list::-webkit-scrollbar{width:10px}
    .list::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border: 2px solid transparent;
      background-clip: content-box;
      border-radius:999px;
    }
    .list::-webkit-scrollbar-track{background: transparent}
  </style>
</head>
<body>
  <div class="app">
    <div class="left">
      <div class="header">
        <div class="title">
          <h1>Spine Image Explorer</h1>
          <div class="pill"><strong id="visibleCount">0</strong> visible • <span class="small"><span id="totalCount">0</span> total</span></div>
        </div>

        <div class="controls">
          <input id="filterBox" type="text" placeholder="Filter (e.g., Modic, arachnoiditis, foraminal, Adamkiewicz)..." autocomplete="off" />
          <div class="row">
            <select id="engineSelect" title="Search engine (for image results)">
              <option value="google" selected>Google Images (may block embedding)</option>
              <option value="bing">Bing Images (often embeddable)</option>
              <option value="ddg">DuckDuckGo Images (often embeddable)</option>
            </select>
            <select id="categorySelect" title="Category filter">
              <option value="__all__" selected>All categories</option>
            </select>
          </div>
        </div>

        <div class="hint">
          Click a card to load images on the right.
          Keyboard: <span class="kbd">↑</span><span class="kbd">↓</span> to move, <span class="kbd">Enter</span> to load, <span class="kbd">O</span> open new tab, <span class="kbd">C</span> copy link.
        </div>
      </div>

      <div id="list" class="list"></div>
    </div>

    <div class="right">
      <div class="rightTop">
        <div>
          <p class="nowTitle" id="nowTitle">Select a topic</p>
          <p class="nowSub" id="nowSub">Choose a card on the left to load an image search here.</p>
        </div>
        <div class="btns">
          <button class="primary" id="openBtn" disabled>Open in new tab</button>
          <button id="copyBtn" disabled>Copy link</button>
          <button id="prevBtn" disabled>Prev</button>
          <button id="nextBtn" disabled>Next</button>
        </div>
      </div>

      <div class="viewerWrap">
        <iframe id="viewer" title="Image search viewer"></iframe>

        <div class="overlay" id="overlay">
          <div class="note">
            <div class="icon">!</div>
            <div class="txt">
              <p class="line1">Embedding limitation</p>
              <p class="line2">
                Some sites (especially Google Images) may refuse to load inside an embedded panel.
                If you see “refused to connect,” use <strong>Open in new tab</strong> or switch the engine to Bing / DuckDuckGo.
              </p>
            </div>
            <div class="noteBtns">
              <button class="primary" id="overlayOpenBtn">Open in new tab</button>
              <button id="overlayHideBtn">Hide</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== DATA (raw JS array; straight double-quotes) =====
    const SEARCHES = [
      // Vascular spinal cord
      {"category":"Vascular spinal cord","name":"Spinal cord infarct","modality":"MRI DWI","query":"spinal cord infarct MRI DWI","severity":"bad"},
      {"category":"Vascular spinal cord","name":"Aortic stent graft covering artery of Adamkiewicz","modality":"CTA","query":"artery of Adamkiewicz covered by stent graft CTA","severity":"warn"},
      {"category":"Vascular spinal cord","name":"Endovascular aneurysm repair stent graft","modality":"CTA","query":"endovascular stent graft aneurysm repair CTA","severity":"warn"},
      {"category":"Vascular spinal cord","name":"Thoracic aortic dissection treated with stent graft","modality":"CTA","query":"thoracic aortic dissection stent graft CTA","severity":"warn"},

      // Conus and tethering
      {"category":"Conus and tethering","name":"Low-lying conus medullaris","modality":"Lumbar spine MRI","query":"low lying conus medullaris MRI lumbar spine","severity":"warn"},
      {"category":"Conus and tethering","name":"Tethered cord","modality":"Lumbar spine MRI","query":"tethered cord MRI lumbar spine","severity":"warn"},

      // Epidural fat pathology
      {"category":"Epidural fat","name":"Epidural lipomatosis","modality":"Lumbar spine MRI","query":"epidural lipomatosis MRI lumbar spine","severity":"warn"},

      // Stenosis and measurements
      {"category":"Stenosis and measurements","name":"Torg–Pavlov ratio","modality":"Cervical spine lateral radiograph","query":"Torg Pavlov ratio cervical spine lateral radiograph","severity":"cyan"},
      {"category":"Stenosis and measurements","name":"Cervical spinal stenosis","modality":"Cervical spine MRI","query":"cervical spinal stenosis MRI","severity":"warn"},
      {"category":"Stenosis and measurements","name":"Congenital lumbar stenosis (short pedicles)","modality":"CT","query":"congenital lumbar spinal stenosis short pedicles CT","severity":"warn"},

      // Degenerative spondylosis and bony proliferations
      {"category":"Degenerative bony change","name":"Spondylosis deformans","modality":"Spine radiograph","query":"spondylosis deformans spine radiograph","severity":"green"},
      {"category":"Degenerative bony change","name":"Osteophytes (\"claw-like\")","modality":"Spine radiograph","query":"claw like osteophytes spine radiograph","severity":"green"},
      {"category":"Degenerative bony change","name":"Intervertebral osteochondrosis / degenerative disc disease (endplate-centered)","modality":"Spine radiograph","query":"intervertebral osteochondrosis spine radiograph","severity":"green"},
      {"category":"Degenerative bony change","name":"Syndesmophytes","modality":"Spine radiograph","query":"syndesmophytes spine radiograph","severity":"cyan"},
      {"category":"Degenerative bony change","name":"Ankylosing spondylitis syndesmophytes","modality":"Spine radiograph","query":"ankylosing spondylitis syndesmophytes spine radiograph","severity":"cyan"},

      // Endplate marrow changes (Modic)
      {"category":"Modic endplate changes","name":"Modic type 1 changes","modality":"Spine MRI","query":"Modic type 1 changes MRI","severity":"warn"},
      {"category":"Modic endplate changes","name":"Modic type 2 changes","modality":"Spine MRI","query":"Modic type 2 changes MRI","severity":"green"},
      {"category":"Modic endplate changes","name":"Modic type 3 changes","modality":"Spine MRI","query":"Modic type 3 changes MRI","severity":"green"},
      {"category":"Modic endplate changes","name":"Spinal osteomyelitis (Modic 1 mimic)","modality":"Spine MRI","query":"spinal osteomyelitis MRI Modic type 1 mimic","severity":"bad"},

      // Annulus and disc integrity
      {"category":"Annulus and disc integrity","name":"Annular fissure","modality":"Spine MRI","query":"annular fissure MRI spine","severity":"green"},
      {"category":"Annulus and disc integrity","name":"High Intensity Zone (HIZ)","modality":"Spine MRI","query":"high intensity zone HIZ annular fissure MRI","severity":"green"},
      {"category":"Annulus and disc integrity","name":"Discography for annular fissure","modality":"Fluoroscopy discography","query":"discography annular fissure fluoroscopy","severity":"cyan"},

      // Intravertebral disc herniation and juvenile kyphosis
      {"category":"Schmorl / Scheuermann","name":"Schmorl node","modality":"Spine MRI","query":"Schmorl node MRI","severity":"green"},
      {"category":"Schmorl / Scheuermann","name":"Scheuermann disease","modality":"Thoracic spine radiograph","query":"Scheuermann disease thoracic spine radiograph","severity":"cyan"},
      {"category":"Schmorl / Scheuermann","name":"Vertebral body wedging","modality":"Thoracic spine radiograph","query":"vertebral body wedging thoracic spine radiograph","severity":"cyan"},
      {"category":"Schmorl / Scheuermann","name":"Scheuermann kyphosis","modality":"Thoracic spine radiograph","query":"Scheuermann kyphosis thoracic spine radiograph","severity":"cyan"},
      {"category":"Schmorl / Scheuermann","name":"Scheuermann disease with scoliosis","modality":"Spine radiograph","query":"Scheuermann disease scoliosis spine radiograph","severity":"cyan"},

      // Fracture mimic
      {"category":"Fracture mimic","name":"Limbus vertebra","modality":"Spine CT","query":"limbus vertebra CT","severity":"warn"},
      {"category":"Fracture mimic","name":"Limbus vertebra fracture mimic","modality":"Spine CT","query":"limbus vertebra fracture mimic CT","severity":"warn"},

      // Disc displacement types
      {"category":"Disc displacement types","name":"Disc herniation","modality":"Spine MRI","query":"disc herniation MRI","severity":"warn"},
      {"category":"Disc displacement types","name":"Disc bulge","modality":"Spine MRI","query":"disc bulge MRI","severity":"green"},
      {"category":"Disc displacement types","name":"Disc protrusion","modality":"Spine MRI","query":"disc protrusion MRI","severity":"warn"},
      {"category":"Disc displacement types","name":"Disc extrusion","modality":"Spine MRI","query":"disc extrusion MRI","severity":"warn"},
      {"category":"Disc displacement types","name":"Sequestered disc fragment","modality":"Spine MRI","query":"sequestered disc fragment MRI","severity":"warn"},

      // Axial location & nerve compression
      {"category":"Axial location & nerve compression","name":"Subarticular (lateral recess) disc herniation","modality":"Axial spine MRI","query":"subarticular lateral recess disc herniation axial MRI","severity":"warn"},
      {"category":"Axial location & nerve compression","name":"Central disc herniation","modality":"Axial spine MRI","query":"central disc herniation axial MRI","severity":"warn"},
      {"category":"Axial location & nerve compression","name":"Foraminal disc herniation","modality":"Axial spine MRI","query":"foraminal disc herniation axial MRI","severity":"warn"},
      {"category":"Axial location & nerve compression","name":"Extraforaminal disc herniation","modality":"Axial spine MRI","query":"extraforaminal disc herniation axial MRI","severity":"warn"},
      {"category":"Axial location & nerve compression","name":"Exiting nerve root compression (foraminal disc)","modality":"Lumbar MRI","query":"exiting nerve root compression foraminal disc MRI lumbar","severity":"warn"},
      {"category":"Axial location & nerve compression","name":"Traversing nerve root compression (central/subarticular disc)","modality":"Lumbar MRI","query":"traversing nerve root compression central disc MRI lumbar","severity":"warn"},
      {"category":"Axial location & nerve compression","name":"Foraminal disc herniation near dorsal root ganglion","modality":"Lumbar MRI","query":"foraminal disc herniation dorsal root ganglion MRI","severity":"cyan"},

      // Nerve root anomaly
      {"category":"Nerve root anomaly","name":"Conjoined nerve root","modality":"Lumbar spine MRI","query":"conjoined nerve root MRI lumbar","severity":"warn"},
      {"category":"Nerve root anomaly","name":"Conjoined nerve root: anterolateral dural sac asymmetry","modality":"Axial T1 MRI","query":"conjoined nerve root anterolateral dural sac asymmetry axial T1 MRI","severity":"cyan"},
      {"category":"Nerve root anomaly","name":"Duplicated nerve root","modality":"Lumbar spine MRI","query":"duplicated nerve root MRI lumbar","severity":"cyan"},

      // Myelography injection findings
      {"category":"Myelography","name":"Normal myelogram: contrast outlines cauda equina","modality":"Fluoroscopy","query":"myelogram contrast outlines cauda equina fluoroscopy","severity":"green"},
      {"category":"Myelography","name":"Pooling of contrast at needle tip (myelogram)","modality":"Fluoroscopy","query":"myelogram pooling contrast at needle tip fluoroscopy","severity":"warn"},
      {"category":"Myelography","name":"Subdural contrast injection during myelogram","modality":"Fluoroscopy","query":"subdural injection myelogram fluoroscopy","severity":"warn"},
      {"category":"Myelography","name":"Epidural contrast injection during myelogram","modality":"Fluoroscopy","query":"epidural contrast injection myelogram fluoroscopy","severity":"warn"},

      // LP complications and treatment
      {"category":"LP complication & treatment","name":"Post–dural puncture headache / intracranial hypotension","modality":"Brain MRI","query":"post dural puncture headache intracranial hypotension brain MRI","severity":"warn"},
      {"category":"LP complication & treatment","name":"Subdural hematoma after lumbar puncture","modality":"Head CT","query":"subdural hematoma CT head post lumbar puncture","severity":"bad"},
      {"category":"LP complication & treatment","name":"Epidural blood patch","modality":"Fluoroscopy","query":"epidural blood patch fluoroscopy","severity":"green"},
      {"category":"LP complication & treatment","name":"Spinal CSF leak after lumbar puncture","modality":"Spine MRI","query":"CSF leak after lumbar puncture spine MRI","severity":"warn"},

      // Postoperative spine / failed back surgery
      {"category":"Postoperative / failed back","name":"Failed back surgery syndrome","modality":"Postoperative lumbar MRI","query":"failed back surgery syndrome MRI lumbar","severity":"warn"},
      {"category":"Postoperative / failed back","name":"Adjacent segment degeneration after spinal fusion","modality":"Spine MRI","query":"adjacent segment degeneration after spinal fusion MRI","severity":"warn"},
      {"category":"Postoperative / failed back","name":"Recurrent disc herniation vs epidural fibrosis (post-contrast)","modality":"Spine MRI post-contrast","query":"recurrent disc herniation vs epidural fibrosis post contrast MRI","severity":"warn"},
      {"category":"Postoperative / failed back","name":"Postoperative epidural fibrosis / scar tissue enhancement","modality":"Spine MRI post-contrast","query":"epidural fibrosis postoperative spine MRI contrast enhancement","severity":"warn"},

      // Arachnoiditis buzzwords
      {"category":"Arachnoiditis","name":"Arachnoiditis","modality":"Spine MRI","query":"arachnoiditis MRI spine","severity":"warn"},
      {"category":"Arachnoiditis","name":"Arachnoiditis: \"Clumped nerve roots\"","modality":"Spine MRI","query":"clumped nerve roots arachnoiditis MRI","severity":"warn"},
      {"category":"Arachnoiditis","name":"Arachnoiditis: \"Empty thecal sac\" sign","modality":"Spine MRI","query":"empty thecal sac sign arachnoiditis MRI","severity":"warn"},

      // Postop infection
      {"category":"Postoperative / infection concern","name":"Postoperative spine infection","modality":"Spine MRI post-contrast","query":"postoperative spine infection MRI with contrast","severity":"bad"}
    ];

    // ===== HELPERS =====
    function engineUrl(engine, q){
      const enc = encodeURIComponent(q);
      if(engine === "google") return "https://www.google.com/search?tbm=isch&q=" + enc;
      if(engine === "bing") return "https://www.bing.com/images/search?q=" + enc;
      return "https://duckduckgo.com/?q=" + enc + "&iax=images&ia=images";
    }

    function dotClass(sev){
      if(sev === "bad") return "dot bad";
      if(sev === "warn") return "dot warn";
      if(sev === "green") return "dot green";
      if(sev === "cyan") return "dot cyan";
      return "dot";
    }

    function showToast(msg){
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1400);
    }

    // ===== STATE =====
    const state = {
      engine: "google",
      category: "__all__",
      filter: "",
      visible: [],
      selectedIndex: -1,
      selectedItem: null
    };

    // ===== UI ELEMENTS =====
    const listEl = document.getElementById("list");
    const filterBox = document.getElementById("filterBox");
    const engineSelect = document.getElementById("engineSelect");
    const categorySelect = document.getElementById("categorySelect");

    const viewer = document.getElementById("viewer");
    const nowTitle = document.getElementById("nowTitle");
    const nowSub = document.getElementById("nowSub");

    const openBtn = document.getElementById("openBtn");
    const copyBtn = document.getElementById("copyBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    const overlay = document.getElementById("overlay");
    const overlayOpenBtn = document.getElementById("overlayOpenBtn");
    const overlayHideBtn = document.getElementById("overlayHideBtn");

    // ===== INIT: category options =====
    const categories = Array.from(new Set(SEARCHES.map(x=>x.category))).sort((a,b)=>a.localeCompare(b));
    for(const c of categories){
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      categorySelect.appendChild(opt);
    }

    document.getElementById("totalCount").textContent = String(SEARCHES.length);

    // ===== RENDER =====
    function applyFilters(){
      const f = state.filter.trim().toLowerCase();
      state.visible = SEARCHES.filter(item=>{
        if(state.category !== "__all__" && item.category !== state.category) return false;
        if(!f) return true;
        const hay = (item.name + " " + item.modality + " " + item.query + " " + item.category).toLowerCase();
        return hay.includes(f);
      });

      document.getElementById("visibleCount").textContent = String(state.visible.length);

      // Keep selection valid
      if(state.visible.length === 0){
        state.selectedIndex = -1;
        state.selectedItem = null;
      }else{
        if(state.selectedIndex < 0) state.selectedIndex = 0;
        if(state.selectedIndex >= state.visible.length) state.selectedIndex = state.visible.length - 1;
        state.selectedItem = state.visible[state.selectedIndex];
      }
    }

    function groupVisible(){
      const map = new Map();
      for(const item of state.visible){
        if(!map.has(item.category)) map.set(item.category, []);
        map.get(item.category).push(item);
      }
      return Array.from(map.entries()).sort((a,b)=>a[0].localeCompare(b[0]));
    }

    function renderList(){
      listEl.innerHTML = "";

      const groups = groupVisible();
      if(groups.length === 0){
        const empty = document.createElement("div");
        empty.style.padding = "14px";
        empty.style.color = "rgba(233,240,255,.65)";
        empty.innerHTML = "No matches. Clear filters to see items.";
        listEl.appendChild(empty);
        setButtonsEnabled(false);
        return;
      }

      let globalIndex = 0;
      for(const [cat, items] of groups){
        const sec = document.createElement("div");
        sec.className = "section";
        sec.innerHTML = `<h2>${cat}<span class="count">${items.length}</span></h2>`;
        listEl.appendChild(sec);

        for(const item of items){
          const card = document.createElement("div");
          card.className = "card";
          const isActive = (state.selectedItem && item === state.selectedItem);
          if(isActive) card.classList.add("active");

          card.dataset.globalIndex = String(globalIndex);
          card.innerHTML = `
            <div class="name">${item.name}</div>
            <div class="meta">
              <span class="${dotClass(item.severity)}"></span>
              <span class="tag">${item.modality}</span>
              <span class="tag">${cat}</span>
            </div>
          `;

          card.addEventListener("click", ()=>{
            // Convert visible global index to selectedIndex
            const idx = state.visible.indexOf(item);
            if(idx !== -1){
              state.selectedIndex = idx;
              state.selectedItem = state.visible[idx];
              renderList();
              loadSelected();
              scrollActiveIntoView();
            }
          });

          listEl.appendChild(card);
          globalIndex++;
        }
      }

      setButtonsEnabled(true);
    }

    function setButtonsEnabled(enabled){
      openBtn.disabled = !enabled;
      copyBtn.disabled = !enabled;
      prevBtn.disabled = !enabled;
      nextBtn.disabled = !enabled;
    }

    function scrollActiveIntoView(){
      const active = listEl.querySelector(".card.active");
      if(active){
        active.scrollIntoView({block:"nearest", behavior:"smooth"});
      }
    }

    function loadSelected(){
      const item = state.selectedItem;
      if(!item){
        nowTitle.textContent = "Select a topic";
        nowSub.textContent = "Choose a card on the left to load an image search here.";
        viewer.src = "about:blank";
        return;
      }

      const url = engineUrl(state.engine, item.query);
      viewer.src = url;

      nowTitle.textContent = item.name;
      nowSub.textContent = item.modality + " • " + item.category;

      openBtn.onclick = ()=>window.open(url, "_blank", "noopener");
      overlayOpenBtn.onclick = ()=>window.open(url, "_blank", "noopener");

      copyBtn.onclick = async ()=>{
        try{
          await navigator.clipboard.writeText(url);
          showToast("Link copied");
        }catch(e){
          showToast("Copy blocked by browser");
        }
      };

      // show overlay hint if Google selected (most likely to block iframe)
      if(state.engine === "google"){
        overlay.style.display = "flex";
      }else{
        overlay.style.display = "none";
      }
    }

    function moveSelection(delta){
      if(state.visible.length === 0) return;
      let n = state.selectedIndex + delta;
      if(n < 0) n = 0;
      if(n >= state.visible.length) n = state.visible.length - 1;
      state.selectedIndex = n;
      state.selectedItem = state.visible[n];
      renderList();
      loadSelected();
      scrollActiveIntoView();
    }

    // ===== EVENTS =====
    filterBox.addEventListener("input", ()=>{
      state.filter = filterBox.value;
      applyFilters();
      renderList();
      loadSelected();
    });

    engineSelect.addEventListener("change", ()=>{
      state.engine = engineSelect.value;
      renderList();
      loadSelected();
    });

    categorySelect.addEventListener("change", ()=>{
      state.category = categorySelect.value;
      applyFilters();
      renderList();
      loadSelected();
    });

    prevBtn.addEventListener("click", ()=>moveSelection(-1));
    nextBtn.addEventListener("click", ()=>moveSelection(+1));

    overlayHideBtn.addEventListener("click", ()=>{
      overlay.style.display = "none";
    });

    document.addEventListener("keydown", (e)=>{
      const tag = (document.activeElement && document.activeElement.tagName) ? document.activeElement.tagName.toLowerCase() : "";
      const inInput = (tag === "input" || tag === "select" || tag === "textarea");

      if(e.key === "ArrowUp"){
        e.preventDefault();
        moveSelection(-1);
        return;
      }
      if(e.key === "ArrowDown"){
        e.preventDefault();
        moveSelection(+1);
        return;
      }
      if(e.key === "Enter"){
        if(inInput) return;
        e.preventDefault();
        loadSelected();
        return;
      }
      if(e.key.toLowerCase() === "o"){
        if(!state.selectedItem) return;
        const url = engineUrl(state.engine, state.selectedItem.query);
        window.open(url, "_blank", "noopener");
        return;
      }
      if(e.key.toLowerCase() === "c"){
        if(!state.selectedItem) return;
        const url = engineUrl(state.engine, state.selectedItem.query);
        navigator.clipboard.writeText(url).then(()=>showToast("Link copied")).catch(()=>showToast("Copy blocked"));
        return;
      }
      if(e.key === "/"){
        e.preventDefault();
        filterBox.focus();
        return;
      }
      if(e.key === "Escape"){
        if(document.activeElement === filterBox){
          filterBox.blur();
        }else{
          filterBox.value = "";
          state.filter = "";
          applyFilters();
          renderList();
          loadSelected();
        }
      }
    });

    // ===== BOOT =====
    function boot(){
      state.engine = engineSelect.value;
      state.category = categorySelect.value;
      state.filter = filterBox.value;

      applyFilters();
      renderList();

      if(state.visible.length > 0){
        state.selectedIndex = 0;
        state.selectedItem = state.visible[0];
        renderList();
        loadSelected();
        scrollActiveIntoView();
      }
    }

    boot();
  </script>
</body>
</html>
