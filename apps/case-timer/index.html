<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f1116;
      --panel: #161925;
      --accent: #5be7c4;
      --text: #e8edf2;
      --muted: #9ba5b5;
      --danger: #ff6b6b;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(91, 231, 196, 0.08), transparent 28%),
                  radial-gradient(circle at 80% 0%, rgba(91, 231, 196, 0.06), transparent 28%),
                  radial-gradient(circle at 50% 80%, rgba(255, 107, 107, 0.06), transparent 30%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      grid-template-columns: 320px 1fr;
    }

    .session-log {
      background: var(--panel);
      border-right: 1px solid rgba(255, 255, 255, 0.06);
      padding: 28px 22px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-shadow: 8px 0 24px rgba(0, 0, 0, 0.25);
    }

    .session-log h1 {
      font-size: 1.5rem;
      letter-spacing: 0.02em;
    }

    .session-log p {
      color: var(--muted);
      font-size: 0.98rem;
      line-height: 1.5;
    }

    .case-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: calc(100vh - 210px);
      overflow-y: auto;
      padding-right: 6px;
    }

    .case-item {
      padding: 14px 12px 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(4px);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .case-item .label {
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .case-item .duration {
      font-family: 'Inter', monospace;
      color: var(--accent);
      font-weight: 700;
    }

    .muted {
      color: var(--muted);
    }

    .main {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 24px;
      padding: 32px;
    }

    .status-pill {
      position: absolute;
      top: 24px;
      right: 24px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.06);
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .status-pill.running { color: var(--accent); }
    .status-pill.paused { color: #fbd38d; }

    .timer-display {
      font-size: clamp(3.5rem, 9vw, 5.8rem);
      font-weight: 700;
      letter-spacing: 0.05em;
      text-shadow: 0 10px 35px rgba(0, 0, 0, 0.45);
    }

    .hint {
      color: var(--muted);
      letter-spacing: 0.02em;
      font-size: 1rem;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 14px;
      max-width: 820px;
      width: 100%;
      margin-top: 24px;
    }

    .control-card {
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 12px;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.03);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .key {
      min-width: 42px;
      text-align: center;
      padding: 8px 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      font-weight: 700;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    .message {
      margin-top: 10px;
      min-height: 22px;
      color: var(--muted);
      font-size: 0.98rem;
    }

    @media (max-width: 960px) {
      body {
        grid-template-columns: 1fr;
      }

      .session-log {
        border-right: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        flex-direction: row;
        align-items: flex-start;
        gap: 20px;
        max-height: 260px;
      }

      .case-list { max-height: 180px; width: 100%; }
    }
  </style>
</head>
<body>
  <aside class="session-log">
    <div>
      <h1>Case Timer</h1>
      <p>Spacebar starts and pauses. Pause, then press → to save the case and move to the next.</p>
    </div>
    <ul id="caseList" class="case-list">
      <li class="case-item" aria-live="polite">
        <span class="label">No cases yet</span>
        <span class="duration muted">—</span>
      </li>
    </ul>
  </aside>

  <main class="main">
    <div id="statusPill" class="status-pill">Idle</div>
    <div id="timerDisplay" class="timer-display">00:00.000</div>
    <div class="hint">Space: start/pause · →: end current case</div>
    <div id="message" class="message"></div>
    <section class="controls">
      <div class="control-card">
        <span class="key">Space</span>
        <div>
          <div><strong>Start / Pause</strong></div>
          <div class="muted">Toggle the active case timer.</div>
        </div>
      </div>
      <div class="control-card">
        <span class="key">→</span>
        <div>
          <div><strong>End Case</strong></div>
          <div class="muted">Pause first, then save and queue the next case.</div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const timerDisplay = document.getElementById('timerDisplay');
    const statusPill = document.getElementById('statusPill');
    const caseList = document.getElementById('caseList');
    const messageEl = document.getElementById('message');

    let currentCase = null;
    let startTimestamp = null;
    let rafId = null;
    let caseCounter = 0;

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      const millis = Math.floor(ms % 1000);
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(millis).padStart(3, '0')}`;
    }

    function setStatus(state) {
      statusPill.classList.remove('running', 'paused');
      if (state === 'running') {
        statusPill.textContent = 'Running';
        statusPill.classList.add('running');
      } else if (state === 'paused') {
        statusPill.textContent = 'Paused';
        statusPill.classList.add('paused');
      } else {
        statusPill.textContent = 'Idle';
      }
    }

    function updateDisplay() {
      if (!currentCase) return;
      const now = performance.now();
      const elapsed = currentCase.elapsed + (startTimestamp ? now - startTimestamp : 0);
      timerDisplay.textContent = formatTime(elapsed);
      rafId = requestAnimationFrame(updateDisplay);
    }

    function startOrResume() {
      if (!currentCase) {
        currentCase = { id: ++caseCounter, elapsed: 0 };
        messageEl.textContent = `Case ${currentCase.id} started.`;
      } else if (startTimestamp) {
        // Already running; pause instead
        pauseTimer();
        return;
      } else {
        messageEl.textContent = `Case ${currentCase.id} resumed.`;
      }

      startTimestamp = performance.now();
      setStatus('running');
      cancelAnimationFrame(rafId);
      updateDisplay();
    }

    function pauseTimer() {
      if (!currentCase || !startTimestamp) {
        messageEl.textContent = 'Nothing to pause.';
        return;
      }
      const now = performance.now();
      currentCase.elapsed += now - startTimestamp;
      startTimestamp = null;
      setStatus('paused');
      cancelAnimationFrame(rafId);
      timerDisplay.textContent = formatTime(currentCase.elapsed);
      messageEl.textContent = `Case ${currentCase.id} paused.`;
    }

    function endCase() {
      if (!currentCase) {
        messageEl.textContent = 'Start a case first with Space.';
        return;
      }
      if (startTimestamp) {
        messageEl.textContent = 'Pause before ending the case.';
        return;
      }

      const listItem = document.createElement('li');
      listItem.className = 'case-item';
      const label = document.createElement('span');
      label.className = 'label';
      label.textContent = `Case ${currentCase.id}`;
      const duration = document.createElement('span');
      duration.className = 'duration';
      duration.textContent = formatTime(currentCase.elapsed);

      listItem.appendChild(label);
      listItem.appendChild(duration);

      if (caseList.children.length === 1 && caseList.firstElementChild.textContent.includes('No cases yet')) {
        caseList.innerHTML = '';
      }
      caseList.prepend(listItem);

      messageEl.textContent = `Case ${currentCase.id} saved.`;
      currentCase = null;
      startTimestamp = null;
      cancelAnimationFrame(rafId);
      timerDisplay.textContent = '00:00.000';
      setStatus('idle');
    }

    document.addEventListener('keydown', (event) => {
      if (event.code === 'Space') {
        event.preventDefault();
        if (!currentCase || startTimestamp) {
          startOrResume();
        } else {
          pauseTimer();
        }
      }

      if (event.code === 'ArrowRight') {
        event.preventDefault();
        endCase();
      }
    });
  </script>
</body>
</html>
