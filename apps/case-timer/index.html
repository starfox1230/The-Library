<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1016;
      --panel: #141824;
      --accent: #56e0c4;
      --text: #e6ecf3;
      --muted: #9aa4b7;
      --border: rgba(255, 255, 255, 0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(86, 224, 196, 0.12), transparent 28%),
                  radial-gradient(circle at 80% 0%, rgba(86, 224, 196, 0.08), transparent 28%),
                  radial-gradient(circle at 50% 80%, rgba(255, 107, 107, 0.07), transparent 30%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px 18px;
    }

    .layout {
      width: min(1100px, 100%);
      display: grid;
      grid-template-columns: minmax(320px, 1fr) 360px;
      gap: 22px;
      align-items: start;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 18px 38px rgba(0, 0, 0, 0.35);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 14px;
    }

    .header-actions {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    h1, h2 {
      font-size: 1.4rem;
      letter-spacing: 0.02em;
    }

    .icon-button {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
      transition: transform 120ms ease, background 120ms ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    .icon-button:hover { background: rgba(255, 255, 255, 0.1); }
    .icon-button:active { transform: translateY(1px); }

    .settings-menu {
      position: relative;
    }

    .settings-dropdown {
      position: absolute;
      top: 42px;
      right: 0;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 18px 38px rgba(0, 0, 0, 0.45);
      padding: 10px;
      min-width: 190px;
      display: none;
      flex-direction: column;
      gap: 8px;
      z-index: 10;
    }

    .settings-dropdown.open { display: flex; }

    .settings-dropdown button {
      width: 100%;
      text-align: left;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease;
      font-weight: 600;
    }

    .settings-dropdown button:hover { background: rgba(255, 255, 255, 0.1); }
    .settings-dropdown button:active { transform: translateY(1px); }

    .status-pill {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.06);
      color: var(--muted);
      font-weight: 700;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      font-size: 0.8rem;
    }

    .status-pill.running { color: var(--accent); }
    .status-pill.paused { color: #f6c177; }

    .timer-display {
      font-size: clamp(3.1rem, 9vw, 5.4rem);
      font-weight: 700;
      letter-spacing: 0.05em;
      text-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
      text-align: center;
      margin: 10px 0 6px;
      cursor: pointer;
    }

    .hint {
      text-align: center;
      color: var(--muted);
      letter-spacing: 0.01em;
      margin-top: 4px;
    }

    .end-button {
      margin: 10px auto 0;
      display: none;
      padding: 10px 16px;
      border-radius: 999px;
      background: #f56565;
      border: none;
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(245, 101, 101, 0.35);
      transition: transform 120ms ease, background 120ms ease;
    }

    .end-button:hover { background: #ff7b7b; }
    .end-button:active { transform: translateY(1px); }

    .toolbar-row {
      display: flex;
      justify-content: center;
      margin-bottom: 6px;
    }

    .session-log .panel-header {
      margin-bottom: 8px;
    }

    .case-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 62vh;
      overflow-y: auto;
      padding-right: 4px;
    }

    .case-item {
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
    }

    .case-item .actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .case-item button.delete {
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease;
      font-weight: 600;
    }

    .case-item button.delete:hover { background: rgba(255, 255, 255, 0.12); }
    .case-item button.delete:active { transform: translateY(1px); }

    .case-item .label { font-weight: 700; }

    .case-item .duration {
      font-family: 'Inter', monospace;
      color: var(--accent);
      font-weight: 700;
    }

    .muted { color: var(--muted); }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .case-list { max-height: none; }
    }
  </style>
</head>
<body>
  <main class="layout">
    <section class="panel timer-panel">
      <div class="panel-header">
        <h1>Case Timer</h1>
        <div class="header-actions">
          <span id="statusPill" class="status-pill">Idle</span>
          <div class="settings-menu">
            <button id="settingsButton" class="icon-button" aria-expanded="false">⚙️</button>
            <div id="settingsDropdown" class="settings-dropdown" role="menu">
              <button id="printButton" role="menuitem">Print saved data</button>
              <button id="resetButton" role="menuitem">Reset all timers</button>
              <button id="editToggle" role="menuitem">Edit case list</button>
            </div>
          </div>
        </div>
      </div>
      <div id="timerDisplay" class="timer-display" role="button" aria-live="polite">00:00</div>
      <p class="hint">Click or press Space to play / pause · → logs the case</p>
      <div class="toolbar-row">
        <button id="endButton" class="end-button">End Case</button>
      </div>
    </section>

    <section class="panel session-log">
      <div class="panel-header">
        <h2>Past Cases</h2>
        <span id="caseCount" class="muted">No cases</span>
      </div>
      <ul id="caseList" class="case-list">
        <li class="case-item empty" aria-live="polite">
          <span class="label">No cases yet</span>
          <span class="duration muted">—</span>
        </li>
      </ul>
    </section>
  </main>

  <script>
    const timerDisplay = document.getElementById('timerDisplay');
    const statusPill = document.getElementById('statusPill');
    const caseList = document.getElementById('caseList');
    const caseCount = document.getElementById('caseCount');
    const endButton = document.getElementById('endButton');
    const settingsButton = document.getElementById('settingsButton');
    const settingsDropdown = document.getElementById('settingsDropdown');
    const printButton = document.getElementById('printButton');
    const resetButton = document.getElementById('resetButton');
    const editToggle = document.getElementById('editToggle');

    const STORAGE_KEY = 'caseTimerData';

    let currentCase = null;
    let startTimestamp = null;
    let rafId = null;
    let cases = [];
    let isEditing = false;
    let pausedByClick = false;

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function saveState() {
      const data = {
        cases,
        currentCase,
        startTimestamp,
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function setStatus(state) {
      statusPill.classList.remove('running', 'paused');
      if (state === 'running') {
        statusPill.textContent = 'Running';
        statusPill.classList.add('running');
      } else if (state === 'paused') {
        statusPill.textContent = 'Paused';
        statusPill.classList.add('paused');
      } else {
        statusPill.textContent = 'Idle';
      }
    }

    function updateCaseCount() {
      const total = cases.length + (currentCase ? 1 : 0);
      caseCount.textContent = total ? `${total} case${total === 1 ? '' : 's'}` : 'No cases';
    }

    function renderCases() {
      caseList.innerHTML = '';
      if (!cases.length) {
        const empty = document.createElement('li');
        empty.className = 'case-item empty';
        empty.innerHTML = '<span class="label">No cases yet</span><span class="duration muted">—</span>';
        caseList.appendChild(empty);
        return;
      }

      for (let i = cases.length - 1; i >= 0; i--) {
        const entry = cases[i];
        const caseNumber = i + 1;
        const listItem = document.createElement('li');
        listItem.className = 'case-item';

        const label = document.createElement('span');
        label.className = 'label';
        label.textContent = `Case ${caseNumber}`;

        const actions = document.createElement('div');
        actions.className = 'actions';

        const duration = document.createElement('span');
        duration.className = 'duration';
        duration.textContent = formatTime(entry.elapsed);
        actions.appendChild(duration);

        if (isEditing) {
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'delete';
          deleteBtn.textContent = 'Delete';
          deleteBtn.addEventListener('click', () => deleteCase(caseNumber - 1));
          actions.appendChild(deleteBtn);
        }

        listItem.appendChild(label);
        listItem.appendChild(actions);
        caseList.appendChild(listItem);
      }
    }

    function updateDisplay() {
      if (!currentCase || startTimestamp === null) return;
      const now = Date.now();
      const elapsed = currentCase.elapsed + (now - startTimestamp);
      timerDisplay.textContent = formatTime(elapsed);
      rafId = requestAnimationFrame(updateDisplay);
    }

    function startNewCase() {
      currentCase = { number: cases.length + 1, elapsed: 0 };
      startTimestamp = Date.now();
      setStatus('running');
      pausedByClick = false;
      endButton.style.display = 'none';
      cancelAnimationFrame(rafId);
      updateDisplay();
      updateCaseCount();
      saveState();
    }

    function pauseTimer(reason = 'other') {
      if (!currentCase || startTimestamp === null) return;
      const now = Date.now();
      currentCase.elapsed += now - startTimestamp;
      startTimestamp = null;
      cancelAnimationFrame(rafId);
      timerDisplay.textContent = formatTime(currentCase.elapsed);
      setStatus('paused');
      pausedByClick = reason === 'click';
      endButton.style.display = pausedByClick ? 'inline-flex' : 'none';
      saveState();
    }

    function resumeTimer() {
      if (!currentCase) {
        startNewCase();
        return;
      }
      if (startTimestamp !== null) return;
      startTimestamp = Date.now();
      setStatus('running');
      pausedByClick = false;
      endButton.style.display = 'none';
      cancelAnimationFrame(rafId);
      updateDisplay();
      saveState();
    }

    function toggleTimer(trigger = 'other') {
      if (!currentCase) {
        startNewCase();
        return;
      }
      if (startTimestamp === null) {
        resumeTimer();
      } else {
        pauseTimer(trigger);
      }
    }

    function endCase() {
      if (!currentCase) return;

      if (startTimestamp !== null) {
        const now = Date.now();
        currentCase.elapsed += now - startTimestamp;
        startTimestamp = null;
        cancelAnimationFrame(rafId);
      }

      cases.push({ elapsed: currentCase.elapsed });

      currentCase = null;
      startTimestamp = null;
      pausedByClick = false;
      endButton.style.display = 'none';
      cancelAnimationFrame(rafId);
      timerDisplay.textContent = '00:00';
      setStatus('idle');
      updateCaseCount();
      renderCases();
      saveState();
    }

    function deleteCase(index) {
      cases.splice(index, 1);
      if (currentCase) {
        currentCase.number = cases.length + 1;
      }
      renderCases();
      updateCaseCount();
      saveState();
    }

    function resetAll() {
      cases = [];
      currentCase = null;
      startTimestamp = null;
      pausedByClick = false;
      cancelAnimationFrame(rafId);
      timerDisplay.textContent = '00:00';
      setStatus('idle');
      endButton.style.display = 'none';
      isEditing = false;
      editToggle.textContent = 'Edit case list';
      settingsDropdown.classList.remove('open');
      settingsButton.setAttribute('aria-expanded', 'false');
      renderCases();
      updateCaseCount();
      saveState();
    }

    function toggleEditing() {
      isEditing = !isEditing;
      editToggle.textContent = isEditing ? 'Done editing' : 'Edit case list';
      renderCases();
      saveState();
    }

    function loadState() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (!stored) {
        renderCases();
        updateCaseCount();
        return;
      }

      try {
        const parsed = JSON.parse(stored);
        cases = Array.isArray(parsed.cases) ? parsed.cases : [];
        currentCase = parsed.currentCase || null;
        startTimestamp = parsed.startTimestamp || null;
      } catch (error) {
        cases = [];
        currentCase = null;
        startTimestamp = null;
      }

      if (currentCase) {
        if (startTimestamp) {
          const now = Date.now();
          currentCase.elapsed += Math.max(0, now - startTimestamp);
          startTimestamp = now;
          setStatus('running');
          updateDisplay();
          saveState();
        } else {
          timerDisplay.textContent = formatTime(currentCase.elapsed);
          setStatus('paused');
        }
      } else {
        timerDisplay.textContent = '00:00';
        setStatus('idle');
      }

      renderCases();
      updateCaseCount();
    }

    document.addEventListener('keydown', (event) => {
      if (event.code === 'Space') {
        event.preventDefault();
        toggleTimer('keyboard');
      }

      if (event.code === 'ArrowRight') {
        event.preventDefault();
        endCase();
      }
    });

    timerDisplay.addEventListener('click', () => toggleTimer('click'));
    endButton.addEventListener('click', endCase);

    settingsButton.addEventListener('click', (event) => {
      event.stopPropagation();
      const isOpen = settingsDropdown.classList.toggle('open');
      settingsButton.setAttribute('aria-expanded', String(isOpen));
    });

    document.addEventListener('click', (event) => {
      if (!settingsDropdown.contains(event.target) && event.target !== settingsButton) {
        settingsDropdown.classList.remove('open');
        settingsButton.setAttribute('aria-expanded', 'false');
      }
    });

    resetButton.addEventListener('click', () => {
      resetAll();
    });

    printButton.addEventListener('click', () => {
      console.log('Stored case timer data:', { cases, currentCase, startTimestamp });
      settingsDropdown.classList.remove('open');
      settingsButton.setAttribute('aria-expanded', 'false');
    });

    editToggle.addEventListener('click', () => {
      toggleEditing();
      settingsDropdown.classList.remove('open');
      settingsButton.setAttribute('aria-expanded', 'false');
    });

    loadState();
  </script>
</body>
</html>
