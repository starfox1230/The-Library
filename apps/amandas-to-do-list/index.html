<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Prevent zooming and auto-tel links on iOS -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <title>Amanda's Tasks</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <!-- SortableJS -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.6/Sortable.min.js"
    integrity="sha512-/+HQtIdU5+yQJx6REWPxqfXuSFAxl7gH0oTFp5g3k/KsR9SHz6ntKRvab6PT33UXhB0WNS6uZ3M2M4v7thDbiA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>

  <style>
    /* Disable native touch gestures */
    html, body, button, input, textarea {
      touch-action: manipulation;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #FFF0F5;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #6D4C41;
      padding: 20px;
    }

    .app-container {
      position: relative;
      background-color: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(216, 139, 167, 0.15);
      max-width: 500px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #C2185B;
      margin-bottom: 20px;
      font-weight: 600;
      letter-spacing: .5px;
    }

    /* Edit/Done toggle button */
    .toggle-edit-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 6px 12px;
      background: #C2185B;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: .9em;
      cursor: pointer;
      transition: background .2s;
    }
    .toggle-edit-btn.done {
      background: #4CAF50;
    }

    ul {
      list-style: none;
      margin: 0 0 60px;
      padding: 0;
    }

    li {
      display: flex;
      align-items: center;
      padding: 15px 5px;
      border-bottom: 1px solid #F8BBD0;
      transition: background .2s, border .2s;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }
    li:last-child { border-bottom: none; }

    /* Drag handle */
    .drag-handle-amanda {
      display: none;
      cursor: grab;
      margin-right: 10px;
      font-size: 1.2em;
      color: #AD1457;
      padding: 5px;
    }
    .app-container.edit-mode li .drag-handle-amanda {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .app-container.edit-mode .drag-handle-amanda:active {
      cursor: grabbing;
    }

    /* Checkbox */
    .checkbox-container {
      flex-shrink: 0;
      width: 28px;
      text-align: center;
      margin-right: 18px;
      font-size: 1.5em;
      color: #D7CCC8;
      cursor: pointer;
      transition: color .2s;
    }
    .checkbox-container.status-0 .fa-square { display: inline-block; }
    .checkbox-container.status-0 .fa-circle-half-stroke,
    .checkbox-container.status-0 .fa-check-square { display: none; }
    .checkbox-container.status-1 { color: #FFB74D; }
    .checkbox-container.status-1 .fa-circle-half-stroke { display: inline-block; }
    .checkbox-container.status-1 .fa-square,
    .checkbox-container.status-1 .fa-check-square { display: none; }
    .checkbox-container.status-2 { color: #AED581; }
    .checkbox-container.status-2 .fa-check-square { display: inline-block; }
    .checkbox-container.status-2 .fa-square,
    .checkbox-container.status-2 .fa-circle-half-stroke { display: none; }

    /* Task text */
    .task-text {
      flex-grow: 1;
      cursor: pointer;
      user-select: none;
      transition: color .3s, text-decoration .3s;
    }
    li.status-1 .task-text { color: #8D6E63; }
    li.status-2 .task-text {
      text-decoration: line-through;
      color: #BCAAA4;
    }

    /* Pastel backgrounds for done tasks */
    .pastel-bg-1 { background: #FFDFD3; }
    .pastel-bg-2 { background: #D4F0F0; }
    .pastel-bg-3 { background: #E6E0FF; }
    .pastel-bg-4 { background: #FFFACD; }
    li.status-2.pastel-bg-1 .task-text,
    li.status-2.pastel-bg-2 .task-text,
    li.status-2.pastel-bg-3 .task-text,
    li.status-2.pastel-bg-4 .task-text {
      color: #6D4C41;
    }

    /* Edit mode visuals */
    .app-container.edit-mode li {
      border: 1px dashed #E91E63;
      margin-bottom: -1px;
    }
    .app-container.edit-mode .checkbox-container {
      cursor: default;
    }
    .app-container.edit-mode .task-text {
      cursor: text;
    }

    /* Add Task button */
    .add-task-btn {
      display: none;
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: #C2185B;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(194, 24, 91, 0.3);
    }
    .add-task-btn i { margin-right: 8px; }
    .app-container.edit-mode .add-task-btn {
      display: block;
    }
    .add-task-btn:hover { background: #AD1457; }

    /* Delete button */
    .delete-task-btn {
      display: none;
      color: #E91E63;
      font-size: 1.1em;
      margin-left: 12px;
      padding: 3px 6px;
      cursor: pointer;
      border-radius: 50%;
      transition: background .2s, color .2s;
    }
    .app-container.edit-mode li .delete-task-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .delete-task-btn:hover {
      background: #FCE4EC;
      color: #C2185B;
    }

    /* SortableJS ghost */
    .sortable-ghost {
      opacity: .4;
      background: #FFECF0 !important;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.7em; margin-bottom: 20px; }
      .checkbox-container { width: 25px; margin-right: 12px; font-size: 1.3em; }
      .task-text { font-size: .95em; }
      li { padding: 12px 5px; }
      .add-task-btn { font-size: .9em; padding: 8px 15px; }
      .delete-task-btn { font-size: 1em; margin-left: 8px; }
    }
  </style>

  <script>
    // Prevent the 300ms double-tap zoom on non-form elements
    let lastTouchEnd = 0;
    document.addEventListener('touchend', e => {
      const now = Date.now();
      if (
        now - lastTouchEnd <= 300 &&
        !['INPUT', 'TEXTAREA', 'BUTTON', 'SUMMARY'].includes(e.target.tagName)
      ) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });
  </script>
</head>

<body>
  <div class="app-container">
    <h1>Amanda's Tasks</h1>
    <button id="toggleEditBtnAmanda" class="toggle-edit-btn">
      <i class="fas fa-edit"></i> Edit
    </button>

    <ul id="taskListAmanda"></ul>

    <button id="addTaskBtnAmanda" class="add-task-btn">
      <i class="fas fa-plus"></i> Add Task
    </button>
  </div>

  <script>
  (function(){
    const STORAGE_KEY = 'amandaTasks_v2_storage';
    const defaults = [
      { id: 'amanda-task-1', text: "ðŸ‘• Put rest of my clothes in bins", status: 0 },
      { id: 'amanda-task-2', text: "ðŸ‘Ÿ Put my shoes in closet", status: 0 },
      { id: 'amanda-task-3', text: "ðŸ‘§ Put away girlsâ€™ old shoes (attic box)", status: 0 },
      { id: 'amanda-task-4', text: "ðŸ§º Put away all my clean clothes", status: 0 },
      { id: 'amanda-task-5', text: "ðŸ›ï¸ Tidy our room â€“ bench, sheets (Sterling will help)", status: 0 },
      { id: 'amanda-task-6', text: "ðŸ§¼ Clean our closet dresser top", status: 0 },
      { id: 'amanda-task-7', text: "ðŸ› Clean bathroom countertop", status: 0 }
    ];
    let tasks = [], isEditMode = false, sortableInst = null;
    const pastel = ['pastel-bg-1','pastel-bg-2','pastel-bg-3','pastel-bg-4'];
    const listEl = document.getElementById('taskListAmanda'),
          toggleBtn = document.getElementById('toggleEditBtnAmanda'),
          addBtn    = document.getElementById('addTaskBtnAmanda');

    function genId(){
      return 'task-'+Date.now()+'-'+Math.random().toString(36).slice(2,9);
    }
    function load(){
      try {
        const s = localStorage.getItem(STORAGE_KEY);
        const arr = JSON.parse(s);
        if(Array.isArray(arr)) tasks = arr;
        else throw 0;
      } catch {
        tasks = defaults.map(t=>({...t}));
      }
    }
    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }
    function render(){
      listEl.innerHTML = '';
      let doneCount = 0;
      tasks.forEach(t => {
        const li = document.createElement('li');
        li.dataset.id = t.id;
        li.className = `status-${t.status}` + (isEditMode?' edit-mode-item':'');
        if(t.status===2) li.classList.add(pastel[doneCount++%pastel.length]);

        if(isEditMode){
          const h = document.createElement('span');
          h.className='drag-handle-amanda';
          h.innerHTML='<i class="fas fa-grip-vertical"></i>';
          li.appendChild(h);
        }

        const chk = document.createElement('span');
        chk.className = `checkbox-container status-${t.status}`;
        chk.innerHTML = '<i class="far fa-square"></i><i class="fas fa-circle-half-stroke"></i><i class="far fa-check-square"></i>';
        if(!isEditMode) chk.addEventListener('click',()=>{ t.status=(t.status+1)%3; save(); render(); });
        li.appendChild(chk);

        const txt = document.createElement('span');
        txt.className='task-text';
        txt.textContent = t.text;
        if(isEditMode){
          txt.title='Click to edit';
          txt.addEventListener('click',()=>editText(t.id,li));
        } else {
          txt.addEventListener('click',()=>{ t.status=(t.status+1)%3; save(); render(); });
        }
        li.appendChild(txt);

        if(isEditMode){
          const del = document.createElement('span');
          del.className='delete-task-btn';
          del.innerHTML='<i class="fas fa-times"></i>';
          del.title='Delete';
          del.addEventListener('click',()=>{ tasks = tasks.filter(x=>x.id!==t.id); save(); render(); });
          li.appendChild(del);
        }

        listEl.appendChild(li);
      });
    }

    function editText(id, li){
      const t = tasks.find(x=>x.id===id), span = li.querySelector('.task-text');
      if(!t||!span) return;
      const inp = document.createElement('input');
      inp.type='text'; inp.value=t.text; inp.className='task-edit-input';
      inp.addEventListener('blur',()=>{
        const v=inp.value.trim(); if(v) t.text=v; save(); render();
      });
      inp.addEventListener('keydown',e=>{
        if(e.key==='Enter'){ e.preventDefault(); inp.blur(); }
        if(e.key==='Escape'){ inp.value=t.text; inp.blur(); }
      });
      span.replaceWith(inp);
      inp.focus(); inp.select();
    }

    function enterEditMode(){
      isEditMode = true;
      document.querySelector('.app-container').classList.add('edit-mode');
      render();
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints;
      const opts = {
        animation:150,
        ghostClass:'sortable-ghost',
        chosenClass:'sortable-chosen',
        dragClass:'sortable-drag',
        forceFallback:true,
        fallbackOnBody:true,
        filter: '.task-edit-input, .delete-task-btn, .checkbox-container',
        preventOnFilter:true
      };
      if(!isTouch) opts.handle = '.drag-handle-amanda';
      sortableInst = new Sortable(listEl, opts);
    }

    function exitEditMode(){
      if(sortableInst){ sortableInst.destroy(); sortableInst = null; }
      isEditMode = false;
      document.querySelector('.app-container').classList.remove('edit-mode');
      save(); render();
    }

    function addTask(){
      if(!isEditMode) return;
      const newT = { id: genId(), text:'New Task', status:0 };
      tasks.push(newT); save(); render();
      const li = listEl.querySelector(`li[data-id="${newT.id}"]`);
      if(li) editText(newT.id, li);
    }

    toggleBtn.addEventListener('click', ()=>{
      if(isEditMode){
        exitEditMode();
        toggleBtn.classList.remove('done');
        toggleBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
      } else {
        enterEditMode();
        toggleBtn.classList.add('done');
        toggleBtn.innerHTML = '<i class="fas fa-check"></i> Done';
      }
    });
    addBtn.addEventListener('click', addTask);

    document.addEventListener('DOMContentLoaded', ()=>{
      load(); render();
    });
  })();
  </script>
</body>
</html>