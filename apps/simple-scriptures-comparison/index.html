<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verse Side-by-Side Comparator</title>
  <style>
    :root{
      --bg:#0b0e14;
      --panel:#121826;
      --panel2:#0f1422;
      --border:#24304a;
      --text:#e7ecf5;
      --muted:#aab3c5;
      --accent:#7aa2ff;
      --bad:#ff6b6b;
      --good:#51cf66;
      --warn:#ffd43b;
      --chip:#1b2741;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, #141b2d 0%, var(--bg) 45%) fixed;
      color:var(--text);
    }
    header{
      padding:18px 16px 10px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: linear-gradient(180deg, rgba(18,24,38,0.9), rgba(11,14,20,0.0));
      position: sticky;
      top:0;
      backdrop-filter: blur(10px);
      z-index: 5;
    }
    header h1{
      margin:0 0 6px;
      font-size:16px;
      font-weight:650;
      letter-spacing:0.2px;
    }
    header .sub{
      color:var(--muted);
      font-size:12.5px;
      line-height:1.4;
      margin:0;
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:14px 12px 40px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items: start;
    }
    .card{
      background: linear-gradient(180deg, rgba(18,24,38,0.92), rgba(12,16,26,0.92));
      border:1px solid rgba(255,255,255,0.08);
      border-radius:14px;
      overflow:hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    .card .title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.15);
    }
    .card .title .label{
      font-size:12.5px;
      color:var(--muted);
    }
    .card textarea{
      width:100%;
      min-height:220px;
      resize:vertical;
      padding:12px;
      border:0;
      outline:0;
      color:var(--text);
      background: transparent;
      font-size:13.5px;
      line-height:1.45;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin:12px 0 10px;
    }
    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    button{
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(122,162,255,0.16);
      color: var(--text);
      padding:9px 11px;
      border-radius:12px;
      font-weight:600;
      font-size:12.5px;
      cursor:pointer;
      transition: transform 0.05s ease, background 0.15s ease, border-color 0.15s ease;
      user-select:none;
    }
    button:hover{ background: rgba(122,162,255,0.22); border-color: rgba(122,162,255,0.35); }
    button:active{ transform: translateY(1px); }
    .btn-ghost{
      background: rgba(255,255,255,0.06);
    }
    .btn-warn{
      background: rgba(255,212,59,0.16);
      border-color: rgba(255,212,59,0.22);
    }
    .btn-warn:hover{
      background: rgba(255,212,59,0.22);
      border-color: rgba(255,212,59,0.35);
    }
    .status{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted);
      font-size:12px;
    }
    .chip{
      display:inline-flex;
      gap:6px;
      align-items:center;
      background: rgba(27,39,65,0.8);
      border:1px solid rgba(255,255,255,0.08);
      padding:6px 9px;
      border-radius:999px;
      color: var(--muted);
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background: var(--accent);
      box-shadow: 0 0 0 2px rgba(122,162,255,0.18);
    }

    .outwrap{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .out{
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.16);
    }
    .out .head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.2);
      position: sticky;
      top: 62px; /* below header */
      z-index: 2;
      backdrop-filter: blur(10px);
    }
    .out .head .hlabel{
      font-size:12.5px;
      font-weight:700;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .out .head .hlabel span{
      color: var(--muted);
      font-weight:600;
      font-size:12px;
    }
    .out .body{
      max-height: 62vh;
      overflow:auto;
    }

    /* row grid that keeps both columns aligned */
    .rows{
      display:grid;
      grid-auto-rows: minmax(0, auto);
    }
    .row{
      border-bottom:1px solid rgba(255,255,255,0.06);
      padding:10px 12px 12px;
      position: relative;
      background: rgba(15,20,34,0.35);
    }
    .row:nth-child(2n){
      background: rgba(15,20,34,0.18);
    }
    .vtop{
      display:flex;
      align-items:baseline;
      gap:10px;
      margin-bottom:6px;
    }
    .vnum{
      flex:0 0 auto;
      font-weight:800;
      color: var(--accent);
      letter-spacing:0.2px;
      font-size:13px;
      min-width: 34px;
    }
    .vtag{
      font-size:11px;
      color: var(--muted);
      background: rgba(27,39,65,0.55);
      border:1px solid rgba(255,255,255,0.08);
      padding:3px 7px;
      border-radius:999px;
    }
    .vtext{
      font-size:13.5px;
      line-height:1.45;
      white-space:pre-wrap;
      word-break:break-word;
      margin:0;
    }
    .missing{
      border:1px dashed rgba(255,107,107,0.35);
      background: rgba(255,107,107,0.08);
      border-radius:10px;
      padding:10px;
    }
    .missing .vtext{ color: rgba(231,236,245,0.75); }
    .note{
      margin-top:10px;
      font-size:12.5px;
      color: var(--muted);
      line-height:1.5;
    }
    .small{
      font-size:12px;
      color: var(--muted);
    }
    .footer{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size:12px;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
      .outwrap{ grid-template-columns:1fr; }
      .out .head{ top: 112px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="padding:0 12px;">
      <h1>Verse Side-by-Side Comparator</h1>
      <p class="sub">
        Paste two versions of a chapter. The app matches verses by the pattern <span style="color:var(--text);font-weight:650;">number + period</span> (e.g., <span style="color:var(--text);font-weight:650;">“12.”</span>)
        and renders them in aligned rows for quick comparison.
      </p>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <div class="title">
          <div class="label">Left text (e.g., Original)</div>
          <div class="small" id="leftCount">—</div>
        </div>
        <textarea id="leftInput" placeholder="Paste the original here...&#10;&#10;Example:&#10;1. In the beginning...&#10;2. And it came to pass..."></textarea>
      </div>

      <div class="card">
        <div class="title">
          <div class="label">Right text (e.g., Simplified)</div>
          <div class="small" id="rightCount">—</div>
        </div>
        <textarea id="rightInput" placeholder="Paste the new version here...&#10;&#10;Example:&#10;1. God made the world...&#10;2. Enoch kept teaching..."></textarea>
      </div>
    </div>

    <div class="actions">
      <div class="btnrow">
        <button id="renderBtn">Render side-by-side</button>
        <button class="btn-ghost" id="swapBtn">Swap left/right</button>
        <button class="btn-ghost" id="clearBtn">Clear</button>
        <button class="btn-warn" id="demoBtn">Load demo</button>
      </div>

      <div class="status" id="statusLine">
        <span class="chip"><span class="dot"></span><span id="statusText">Ready</span></span>
        <span class="chip" id="verseRangeChip" style="display:none;"></span>
        <span class="chip" id="missingChip" style="display:none;"></span>
      </div>
    </div>

    <div class="outwrap" id="outputArea" style="display:none;">
      <div class="out">
        <div class="head">
          <div class="hlabel">Left <span id="leftLabelHint">(Original)</span></div>
          <div class="small" id="leftVersesMeta"></div>
        </div>
        <div class="body">
          <div class="rows" id="leftRows"></div>
        </div>
      </div>

      <div class="out">
        <div class="head">
          <div class="hlabel">Right <span id="rightLabelHint">(New)</span></div>
          <div class="small" id="rightVersesMeta"></div>
        </div>
        <div class="body">
          <div class="rows" id="rightRows"></div>
        </div>
      </div>
    </div>

    <div class="note">
      Tips:
      <ul style="margin:6px 0 0 18px;">
        <li>Verses must start with <b>number + period</b> (e.g., <b>“7.”</b>). Extra headings are okay; they’ll be ignored unless they match that pattern.</li>
        <li>If a verse is missing on one side, you’ll see a highlighted “Missing” placeholder so rows stay aligned.</li>
        <li>Works best when you keep verse numbers consistent across both versions.</li>
      </ul>
    </div>

    <div class="footer">
      <div>Parsing rule: verse header = <code style="color:var(--text)">^\\s*(\\d+)\\.</code></div>
      <div>Everything runs locally in your browser (no network calls).</div>
    </div>
  </div>

  <script>
    // ---------- Parsing ----------
    // Extract verses keyed by verse number, using pattern: beginning of line => number + period
    function parseVerses(raw) {
      const text = (raw || "").replace(/\r\n/g, "\n");
      const lines = text.split("\n");

      const verses = new Map(); // num -> text
      let currentNum = null;
      let buf = [];

      const verseStart = /^\s*(\d+)\.\s*(.*)$/;

      function flush() {
        if (currentNum !== null) {
          const joined = buf.join("\n").trim();
          verses.set(currentNum, joined);
        }
        buf = [];
      }

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const m = line.match(verseStart);

        if (m) {
          flush();
          currentNum = parseInt(m[1], 10);
          const rest = (m[2] || "").trim();
          buf.push(rest);
        } else {
          if (currentNum !== null) {
            buf.push(line);
          }
        }
      }
      flush();

      return verses;
    }

    function getRangeKeys(mapA, mapB) {
      const keys = new Set();
      for (const k of mapA.keys()) keys.add(k);
      for (const k of mapB.keys()) keys.add(k);
      const arr = Array.from(keys).sort((a,b)=>a-b);
      return arr;
    }

    // ---------- Rendering ----------
    function makeRow(num, text, side, missing=false) {
      const row = document.createElement("div");
      row.className = "row" + (missing ? " missing" : "");

      const top = document.createElement("div");
      top.className = "vtop";

      const vnum = document.createElement("div");
      vnum.className = "vnum";
      vnum.textContent = num + ".";

      const tag = document.createElement("div");
      tag.className = "vtag";
      tag.textContent = missing ? "Missing" : (side === "left" ? "Left" : "Right");

      top.appendChild(vnum);
      top.appendChild(tag);

      const p = document.createElement("p");
      p.className = "vtext";
      p.textContent = text || (missing ? "(no verse text found)" : "");

      row.appendChild(top);
      row.appendChild(p);
      return row;
    }

    function render() {
      const leftRaw = document.getElementById("leftInput").value;
      const rightRaw = document.getElementById("rightInput").value;

      const leftMap = parseVerses(leftRaw);
      const rightMap = parseVerses(rightRaw);

      // meta counts
      document.getElementById("leftCount").textContent = leftMap.size ? `${leftMap.size} verse(s)` : "—";
      document.getElementById("rightCount").textContent = rightMap.size ? `${rightMap.size} verse(s)` : "—";

      const keys = getRangeKeys(leftMap, rightMap);

      const out = document.getElementById("outputArea");
      const leftRows = document.getElementById("leftRows");
      const rightRows = document.getElementById("rightRows");
      leftRows.innerHTML = "";
      rightRows.innerHTML = "";

      let missingLeft = 0;
      let missingRight = 0;

      keys.forEach((k) => {
        const l = leftMap.get(k);
        const r = rightMap.get(k);

        if (l === undefined) missingLeft++;
        if (r === undefined) missingRight++;

        leftRows.appendChild(makeRow(k, l ?? "", "left", l === undefined));
        rightRows.appendChild(makeRow(k, r ?? "", "right", r === undefined));
      });

      // output visibility
      out.style.display = keys.length ? "grid" : "none";

      // status
      const statusText = document.getElementById("statusText");
      const rangeChip = document.getElementById("verseRangeChip");
      const missingChip = document.getElementById("missingChip");

      if (!keys.length) {
        statusText.textContent = "No verses found. Make sure lines start with “1.”, “2.”, etc.";
        rangeChip.style.display = "none";
        missingChip.style.display = "none";
      } else {
        const min = keys[0], max = keys[keys.length - 1];
        statusText.textContent = "Rendered";
        rangeChip.style.display = "inline-flex";
        rangeChip.textContent = `Verses: ${min}–${max} (${keys.length} total)`;

        if (missingLeft || missingRight) {
          missingChip.style.display = "inline-flex";
          missingChip.textContent = `Missing — left: ${missingLeft}, right: ${missingRight}`;
        } else {
          missingChip.style.display = "none";
        }
      }

      // per-side meta
      document.getElementById("leftVersesMeta").textContent = leftMap.size ? `${leftMap.size} parsed` : "0 parsed";
      document.getElementById("rightVersesMeta").textContent = rightMap.size ? `${rightMap.size} parsed` : "0 parsed";

      // sync scroll between the two output panels
      setupScrollSync();
    }

    // ---------- Scroll sync ----------
    let syncing = false;
    function setupScrollSync() {
      const bodies = document.querySelectorAll(".out .body");
      if (bodies.length !== 2) return;

      const [a, b] = bodies;
      a.onscroll = () => {
        if (syncing) return;
        syncing = true;
        b.scrollTop = a.scrollTop;
        syncing = false;
      };
      b.onscroll = () => {
        if (syncing) return;
        syncing = true;
        a.scrollTop = b.scrollTop;
        syncing = false;
      };
    }

    // ---------- Controls ----------
    document.getElementById("renderBtn").addEventListener("click", render);

    document.getElementById("swapBtn").addEventListener("click", () => {
      const l = document.getElementById("leftInput");
      const r = document.getElementById("rightInput");
      const tmp = l.value;
      l.value = r.value;
      r.value = tmp;
      render();
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      document.getElementById("leftInput").value = "";
      document.getElementById("rightInput").value = "";
      document.getElementById("leftRows").innerHTML = "";
      document.getElementById("rightRows").innerHTML = "";
      document.getElementById("outputArea").style.display = "none";
      document.getElementById("statusText").textContent = "Ready";
      document.getElementById("verseRangeChip").style.display = "none";
      document.getElementById("missingChip").style.display = "none";
      document.getElementById("leftCount").textContent = "—";
      document.getElementById("rightCount").textContent = "—";
    });

    document.getElementById("demoBtn").addEventListener("click", () => {
      document.getElementById("leftInput").value =
`1. And it came to pass that Enoch continued his speech...
2. And from that time forth Enoch began to prophesy...
3. And it came to pass that I turned and went up on the mount...
4. And I saw the Lord; and he stood before my face...`;

      document.getElementById("rightInput").value =
`1. Enoch said: Adam taught people about God. Some listened, some did not.
2. Enoch said: God told me to go up a mountain.
3. Enoch went up the mountain and saw wonderful things.
4. Enoch saw God and talked with Him like a friend.`;

      render();
    });

    // auto-render on paste (optional convenience)
    ["leftInput","rightInput"].forEach(id=>{
      document.getElementById(id).addEventListener("paste", () => {
        setTimeout(() => {
          // only render if both have something
          const l = document.getElementById("leftInput").value.trim();
          const r = document.getElementById("rightInput").value.trim();
          if (l && r) render();
        }, 0);
      });
    });
  </script>
</body>
</html>