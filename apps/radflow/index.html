<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RadFlow: Call Mode</title>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #121212;
            --text-main: #e0e0e0;
            --text-dim: #666;
            --accent: #3bc9db; /* Cyan */
            --success: #2f9e44; /* Green */
            --stop: #e03131; /* Red */
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-main);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none; /* Prevent text highlighting */
        }

        /* --- Header --- */
        header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            background: #080808;
        }

        h1 { margin: 0; font-size: 1rem; letter-spacing: 1px; text-transform: uppercase; color: var(--text-dim); }
        h1 span { color: var(--accent); font-weight: 800; }

        select {
            background: #222;
            color: white;
            border: 1px solid #333;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            outline: none;
        }

        /* --- Main Content --- */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* Progress Bar */
        .progress-track {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 6px;
            background: #1a1a1a;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.2s ease-out;
            box-shadow: 0 0 10px var(--accent);
        }

        /* The Focus Card */
        .focus-card {
            width: 600px;
            max-width: 90%;
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.7);
            text-align: center;
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.15s;
            position: relative;
            overflow: hidden;
        }

        /* Flash Overlay for feedback */
        .flash-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: transparent;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .category-label {
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-bottom: 10px;
        }

        .structure-name {
            font-size: 3rem;
            font-weight: 800;
            margin: 0 0 30px 0;
            line-height: 1.1;
            color: white;
        }

        .checklist {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            text-align: left;
            margin-bottom: 30px;
        }

        .check-item {
            font-size: 1.1rem;
            color: #aaa;
            display: flex;
            align-items: center;
            padding: 5px;
            border-radius: 4px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
        }
        
        .check-item::before {
            content: "";
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            margin-right: 12px;
            margin-left: 8px;
            box-shadow: 0 0 5px var(--accent);
        }

        /* Controls Visuals */
        .controls-hint {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            border-top: 1px solid #222;
            padding-top: 20px;
        }

        .key-hint {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #555;
            font-size: 0.8rem;
        }

        .key-box {
            border: 1px solid #444;
            border-radius: 4px;
            padding: 4px 10px;
            color: #ccc;
            background: #222;
            font-family: monospace;
            font-weight: bold;
            font-size: 1rem;
        }

        /* States */
        .finished-state {
            color: var(--success);
        }

    </style>
</head>
<body>

<header>
    <h1>Rad<span>Flow</span> Call Mode</h1>
    <select id="protocolSelect">
        <option value="ct_cap">CT CAP (Pan-Scan)</option>
        <option value="ct_chest">CT Chest</option>
        <option value="ct_ap">CT Abd/Pelvis</option>
        <option value="cta_pe">CTA Chest (PE)</option>
    </select>
</header>

<div class="main-container">
    <div class="progress-track"><div class="progress-fill" id="progressBar"></div></div>

    <div class="focus-card" id="card">
        <div class="flash-overlay" id="flash"></div>
        <div class="category-label" id="catLabel">Loading...</div>
        <h2 class="structure-name" id="structName">Loading...</h2>
        <div class="checklist" id="checkList"></div>

        <div class="controls-hint">
            <div class="key-hint">
                <div class="key-box">←</div>
                <span>Back</span>
            </div>
            <div class="key-hint">
                <div class="key-box">ENTER</div>
                <span style="color:#ff6b6b">Finding</span>
            </div>
            <div class="key-hint">
                <div class="key-box">SPACE / →</div>
                <span style="color:#51cf66">Normal</span>
            </div>
        </div>
    </div>
</div>

<script>
    // Data Structure based on your "Search Pattern" text and "Attending Reports" content
    const PROTOCOLS = {
        ct_cap: [
            { cat: "1. Preliminaries", name: "Scout & History", items: ["Lines/Tubes/Foreign Bodies", "Priors (Oncology/Trauma?)", "Motion/Artifact Check", "Edges of Film"] },
            
            // CHEST
            { cat: "2. Chest - Airway", name: "Trachea & Bronchi", items: ["Trachea Patent?", "Main Bronchi", "Segmental Bronchi", "Endobronchial Lesions"] },
            { cat: "2. Chest - Lungs", name: "Lungs & Pleura", items: ["Nodules (MIPs)", "Consolidation/GGO", "Pneumothorax", "Pleural Effusion"] },
            { cat: "2. Chest - Heart", name: "Heart", items: ["Pericardial Effusion", "Chamber Size", "LAA Thrombus", "Valvular Calcification"] },
            { cat: "2. Chest - Vessels", name: "Thoracic Vessels", items: ["Aortic Aneurysm/Dissection", "Pulmonary Arteries (PE?)", "SVC/IVC Patency", "Arch Branches"] },
            { cat: "2. Chest - Mediastinum", name: "Mediastinum", items: ["Axillary Nodes", "Hilar/Mediastinal Nodes", "Esophagus (Thickening?)", "Thyroid/Lower Neck"] },
            
            // ABDOMEN
            { cat: "3. Abdomen - Viscera", name: "Liver", items: ["Size/Contour (Cirrhosis)", "Focal Lesions (Cysts/Mets)", "Portal/Hepatic Veins", "Periportal Edema"] },
            { cat: "3. Abdomen - Viscera", name: "Biliary System", items: ["Gallbladder (Stones/Wall)", "CBD Dilation", "Intrahepatic Ducts", "Post-cholecystectomy?"] },
            { cat: "3. Abdomen - Viscera", name: "Pancreas", items: ["Parenchyma/Atrophy", "Duct Dilation", "Uncinate Process (Triangular?)", "Peripancreatic Fat"] },
            { cat: "3. Abdomen - Viscera", name: "Spleen", items: ["Splenomegaly", "Infarcts", "Focal Lesions", "Accessory Spleen"] },
            { cat: "3. Abdomen - Viscera", name: "Adrenals", items: ["Nodules (Adenoma vs Met)", "Thickening", "Hemorrhage", "Calcification"] },
            
            // GU GROUPED (User Preference)
            { cat: "3. Abdomen - GU", name: "Kidneys & Ureters", items: ["Hydronephrosis", "Stones", "Renal Masses/Cysts", "Perinephric Stranding", "Ureteral Course"] },
            { cat: "3. Abdomen - GU", name: "Bladder", items: ["Distension", "Wall Thickening", "Intraluminal Masses/Stones", "Air in Bladder?"] },
            
            // PELVIS / REPRO
            { cat: "4. Pelvis", name: "Reproductive", items: ["Uterus/Ovaries (Adnexal Mass)", "Prostate/Seminal Vesicles", "Free Fluid in Pelvis", "Inguinal Canals"] },
            
            // GI TRACT
            { cat: "5. GI Tract", name: "Stomach & Small Bowel", items: ["Distension/Obstruction", "Wall Thickening", "Transition Point?", "Mesenteric Ischemia?"] },
            { cat: "5. GI Tract", name: "Colon & Appendix", items: ["Diverticulitis", "Appendicitis", "Colitis/Wall Thickening", "Masses/Strictures"] },
            
            // SYSTEMIC
            { cat: "6. Systemic", name: "Abd Vessels", items: ["Abd Aorta (Aneurysm)", "Celiac/SMA/IMA Patency", "Renal Arteries", "Iliac/Femoral Arteries"] },
            { cat: "6. Systemic", name: "Peritoneum & Nodes", items: ["Free Air (Lung Windows)", "Ascites", "Mesenteric Nodes", "Retroperitoneal Nodes"] },
            
            // MSK / SOFT TISSUE
            { cat: "7. MSK", name: "Spine", items: ["Vertebral Alignment", "Fractures/Compression", "Discitis/Osteo", "Canal Stenosis"] },
            { cat: "7. MSK", name: "Bones (Other)", items: ["Ribs (Fractures/Mets)", "Pelvic Bones (Sacrum/SI)", "Femoral Heads", "Sternum"] },
            { cat: "8. Soft Tissue", name: "Body Wall", items: ["Hernias (Ventral/Inguinal)", "Subcutaneous Emphysema", "Muscle Asymmetry/Abscess", "Skin Lesions"] },
            
            { cat: "9. Finish", name: "Final Check", items: ["Review Blind Spots", "Correlate with History", "Check Edges of FOV", "Proofread"] }
        ],

        ct_ap: [
            { cat: "1. Preliminaries", name: "Scout & Lower Chest", items: ["Lung Bases (Nodules/Infiltrate)", "Heart Size", "Incidental PE Check", "Pleural Effusion"] },
            { cat: "2. Abdomen - Viscera", name: "Liver", items: ["Size/Contour", "Focal Lesions", "Portal Vein Patency", "Fatty Infiltration"] },
            { cat: "2. Abdomen - Viscera", name: "Biliary & GB", items: ["Gallbladder (Stones/Inflammation)", "Biliary Dilation", "CBD Path"] },
            { cat: "2. Abdomen - Viscera", name: "Pancreas", items: ["Duct Dilation", "Masses", "Pancreatitis (Stranding)", "Atrophy"] },
            { cat: "2. Abdomen - Viscera", name: "Spleen & Adrenals", items: ["Splenomegaly", "Adrenal Nodules", "Thickening"] },
            { cat: "3. Abdomen - GU", name: "Kidneys/Ureters/Bladder", items: ["Stones", "Hydronephrosis", "Renal Masses", "Bladder Wall"] },
            { cat: "4. Pelvis", name: "Reproductive", items: ["Uterus/Ovaries", "Prostate/Seminal Vesicles", "Free Fluid"] },
            { cat: "5. GI Tract", name: "Bowel & Appendix", items: ["Obstruction (SBO)", "Appendicitis", "Diverticulitis", "Colitis"] },
            { cat: "6. Systemic", name: "Vessels & Nodes", items: ["Aorta/Iliacs (Aneurysm)", "Mesenteric Ischemia", "Retroperitoneal Nodes", "Mesenteric Nodes"] },
            { cat: "6. Systemic", name: "Peritoneum", items: ["Free Air", "Ascites", "Abscess Collections"] },
            { cat: "7. MSK", name: "Bones & Soft Tissue", items: ["Spine (Fx/Mets)", "Pelvic Bones", "Hernias", "Body Wall"] }
        ],
        
        ct_chest: [
            { cat: "1. Preliminaries", name: "Scout & Support", items: ["Lines/Tubes", "Pneumothorax on Scout", "Foreign Bodies"] },
            { cat: "2. Airway", name: "Trachea & Bronchi", items: ["Trachea Patency", "Endobronchial Lesions", "Bronchiectasis", "Wall Thickening"] },
            { cat: "3. Lungs", name: "Lung Parenchyma", items: ["Nodules (MIPs)", "Consolidation", "GGO", "Emphysema/Cysts"] },
            { cat: "4. Pleura", name: "Pleural Space", items: ["Effusion", "Pneumothorax", "Pleural Thickening/Plaques"] },
            { cat: "5. Heart", name: "Heart & Pericardium", items: ["Heart Size", "Pericardial Effusion", "Coronary Calcification", "Valves"] },
            { cat: "6. Vessels", name: "Thoracic Vessels", items: ["Aorta (Dissection/Aneurysm)", "Pulmonary Arteries", "SVC/IVC"] },
            { cat: "7. Mediastinum", name: "Mediastinum & Hila", items: ["Adenopathy (Axilla/Hilar)", "Esophagus", "Thyroid", "Thymus"] },
            { cat: "8. MSK", name: "Bones & Wall", items: ["Ribs", "Spine", "Sternum", "Breast Tissue"] }
        ],

        cta_pe: [
            { cat: "1. QC", name: "Quality Check", items: ["Contrast Timing (HU > 200)", "Motion Artifact", "Streak Artifact"] },
            { cat: "2. Pulmonary Arteries", name: "PA Evaluation", items: ["Main PA", "Lobar Branches", "Segmental/Subsegmental", "Webs/Chronic PE"] },
            { cat: "3. Heart", name: "Right Heart Strain", items: ["RV/LV Ratio > 1", "Septal Bowing", "Contrast Reflux to IVC", "Main PA Diameter"] },
            { cat: "4. Lungs", name: "Parenchyma", items: ["Infarcts (Wedge shaped)", "Consolidation", "Effusion", "Malignancy Check"] },
            { cat: "5. Aorta", name: "Aorta & Coronaries", items: ["Dissection", "Coronary Anomalies", "Aneurysm"] },
            { cat: "6. Standard Chest", name: "Rest of Chest", items: ["Mediastinum", "Axilla", "Bones", "Upper Abdomen"] }
        ]
    };

    let currentProtocol = [];
    let currentIndex = 0;

    const ui = {
        card: document.getElementById('card'),
        catLabel: document.getElementById('catLabel'),
        structName: document.getElementById('structName'),
        checkList: document.getElementById('checkList'),
        progressBar: document.getElementById('progressBar'),
        flash: document.getElementById('flash'),
        select: document.getElementById('protocolSelect')
    };

    function init() {
        loadProtocol();
        ui.select.addEventListener('change', loadProtocol);
        
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.key === 'ArrowRight') {
                e.preventDefault();
                nextStep('normal');
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevStep();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                nextStep('finding');
            }
        });
    }

    function loadProtocol() {
        currentProtocol = PROTOCOLS[ui.select.value];
        currentIndex = 0;
        render();
    }

    function nextStep(type) {
        if (currentIndex < currentProtocol.length) {
            flashFeedback(type);
            // Optional: Add a slight delay to the slide to let the flash register
            setTimeout(() => {
                currentIndex++;
                render();
            }, 50);
        }
    }

    function prevStep() {
        if (currentIndex > 0) {
            currentIndex--;
            render();
        }
    }

    function flashFeedback(type) {
        const color = type === 'normal' ? 'rgba(47, 158, 68, 0.3)' : 'rgba(224, 49, 49, 0.3)';
        ui.flash.style.background = color;
        ui.flash.style.opacity = '1';
        setTimeout(() => {
            ui.flash.style.opacity = '0';
        }, 200);
    }

    function render() {
        // Progress
        const pct = Math.min(100, (currentIndex / currentProtocol.length) * 100);
        ui.progressBar.style.width = pct + '%';

        // Finished State
        if (currentIndex >= currentProtocol.length) {
            ui.catLabel.innerText = "Complete";
            ui.structName.innerText = "Dictate & Verify";
            ui.structName.classList.add('finished-state');
            ui.checkList.innerHTML = `
                <div class="check-item">Review edges of film one last time</div>
                <div class="check-item">Proofread report for laterality errors</div>
                <div class="check-item">Check congruence with clinical history</div>
                <div class="check-item">Sign report</div>
            `;
            return;
        }

        // Normal State
        ui.structName.classList.remove('finished-state');
        const step = currentProtocol[currentIndex];
        
        ui.catLabel.innerText = step.cat;
        ui.structName.innerText = step.name;
        
        ui.checkList.innerHTML = '';
        step.items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'check-item';
            div.innerText = item;
            ui.checkList.appendChild(div);
        });

        // Animation trigger (simple CSS shift)
        ui.card.style.transform = "scale(0.98)";
        setTimeout(() => ui.card.style.transform = "scale(1)", 100);
    }

    init();

</script>
</body>
</html>