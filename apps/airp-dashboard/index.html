<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Self-Paced AIRP Tracker (Cozy)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root {
  --bg: #0b1017;
  --bg2: #121927;
  --panel: rgba(13, 18, 28, 0.9);
  --accent: #5ee0ff;
  --accent-soft: rgba(94, 224, 255, 0.1);
  --accent2: #ff77c8;
  --text: #edf4ff;
  --muted: #9aa6bc;
  --success: #77ffc4;
  --radius-lg: 1.4rem;
  --radius-sm: 0.8rem;
  --gap: 1rem;
  --shadow: 0 16px 40px rgba(0,0,0,0.25);
}
*,
*::before,
*::after {
  box-sizing: border-box;
}
body {
  margin: 0;
  background: radial-gradient(circle at 0% 0%, rgba(94,224,255,0.12), rgba(0,0,0,0)) fixed, #080b10;
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.4;
}
.app-shell {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
.header {
  position: sticky;
  top: 0;
  backdrop-filter: blur(16px);
  background: rgba(9, 12, 18, 0.9);
  border-bottom: 1px solid rgba(255,255,255,0.01);
  padding: 0.6rem 1rem 0.55rem 1rem;
  z-index: 20;
  display: flex;
  gap: 0.6rem;
  align-items: center;
}
.title-block h1 {
  font-size: 1.15rem;
  margin: 0;
  font-weight: 600;
}
.title-block small {
  font-size: 0.65rem;
  color: var(--muted);
}
.filters {
  display: flex;
  gap: 0.35rem;
  margin-left: auto;
}
.filter-btn {
  background: rgba(255,255,255,0.01);
  border: 1px solid transparent;
  border-radius: 999px;
  padding: 0.25rem 0.7rem 0.35rem 0.7rem;
  font-size: 0.7rem;
  color: var(--muted);
  cursor: pointer;
}
.filter-btn.active {
  background: rgba(94,224,255,0.14);
  color: var(--text);
  border-color: rgba(94,224,255,0.24);
  box-shadow: 0 0 14px rgba(94,224,255,0.3);
}
.top-actions {
  display: flex;
  gap: 0.35rem;
  margin-left: 0.3rem;
}
.icon-btn {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.03);
  width: 30px;
  height: 30px;
  border-radius: 999px;
  display: grid;
  place-items: center;
  cursor: pointer;
  color: var(--text);
  transition: 0.1s ease-out;
  font-size: 0.9rem;
}
.icon-btn:hover {
  background: rgba(255,255,255,0.1);
}
main {
  max-width: 650px;
  width: 100%;
  margin: 0 auto;
  padding: 1rem 0.6rem 2rem 0.6rem;
}
.lecture-list {
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
}
.lecture-card {
  background: rgba(13, 18, 28, 0.82);
  border: 1px solid rgba(255,255,255,0.016);
  border-radius: 1.1rem;
  box-shadow: 0 12px 25px rgba(0,0,0,0.12);
  overflow: hidden;
  transition: 0.12s ease-out;
}
.lecture-card.done-all {
  border: 1px solid rgba(119,255,196,0.4);
  box-shadow: 0 0 20px rgba(119,255,196,0.12);
}
.lecture-card.glow-blue {
  border: 1px solid rgba(94, 224, 255, 0.5);
  box-shadow: 0 0 28px rgba(94, 224, 255, 0.26);
}
.lecture-card.glow-green {
  border: 1px solid rgba(119, 255, 196, 0.8);
  box-shadow: 0 0 30px rgba(119, 255, 196, 0.35);
}
.lecture-header {
  padding: 0.85rem 0.9rem 0.85rem 0.9rem;
  display: flex;
  gap: 0.8rem;
  align-items: center;
  cursor: pointer;
}
.emoji-block {
  font-size: 1.85rem;
  line-height: 1;
  min-width: 3rem;
  text-align: center;
}
.header-text {
  flex: 1;
}
.lecture-title {
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.25;
}
.lecture-meta {
  display: flex;
  gap: 0.4rem;
  align-items: center;
  margin-top: 0.25rem;
}
.badge-date {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 999px;
  padding: 0.2rem 0.55rem 0.3rem 0.55rem;
  font-size: 0.65rem;
  color: var(--muted);
}
.status-dots {
  display: flex;
  gap: 0.2rem;
}
.st-dot {
  width: 11px;
  height: 11px;
  border-radius: 999px;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.04);
}
.st-done {
  background: rgba(119,255,196,1);
  border: none;
}
.expand-indicator {
  font-size: 1.2rem;
  color: rgba(237,244,255,0.65);
  transition: transform 0.12s ease-out;
}
.lecture-card[data-expanded="true"] .expand-indicator {
  transform: rotate(90deg);
}
.lecture-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.15s ease-out;
  background: rgba(4,5,7,0.15);
}
.lecture-card[data-expanded="true"] .lecture-body {
  max-height: 440px;
}
.lecture-body-inner {
  padding: 0.6rem 1rem 1rem 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  font-size: 0.82rem;
}
.link-line a {
  color: var(--accent);
  text-decoration: none;
  word-break: break-all;
}
.link-line a:hover {
  text-decoration: underline;
}
.checklist {
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
}
.chk {
  background: rgba(255,255,255,0.015);
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 0.7rem;
  padding: 0.35rem 0.7rem 0.4rem;
  display: flex;
  align-items: center;
  gap: 0.45rem;
  font-size: 0.78rem;
  cursor: pointer;
  transition: background 0.09s ease-out, border 0.09s ease-out;
}
.chk input {
  width: 1.05rem;
  height: 1.05rem;
  accent-color: var(--accent);
  margin: 0;
  cursor: pointer;
}
.chk:hover {
  background: rgba(94,224,255,0.12);
  border-color: rgba(94,224,255,0.35);
}
.cards-row {
  display: flex;
  gap: 0.45rem;
  align-items: center;
  font-size: 0.78rem;
  flex-wrap: wrap;
}
.cards-pill {
  background: rgba(94,224,255,0.12);
  border: 1px solid rgba(94,224,255,0.3);
  border-radius: 999px;
  padding: 0.25rem 0.65rem 0.3rem;
}
.cards-row button {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 0.4rem;
  width: 28px;
  height: 26px;
  color: var(--text);
  font-size: 0.78rem;
  cursor: pointer;
}
.cards-row button:hover {
  background: rgba(255,255,255,0.12);
}
.tag-status {
  font-size: 0.65rem;
  background: rgba(119,255,196,0.1);
  border: 1px solid rgba(119,255,196,0.4);
  border-radius: 999px;
  padding: 0.15rem 0.58rem 0.25rem;
  color: #e5fff6;
}
.prefs-panel {
  position: fixed;
  top: 58px;
  right: 0.9rem;
  width: min(360px, 94vw);
  background: rgba(5,7,10,0.9);
  border: 1px solid rgba(255,255,255,0.04);
  border-radius: 1rem;
  padding: 0.75rem;
  box-shadow: 0 15px 30px rgba(0,0,0,0.25);
  z-index: 30;
  display: none;
}
.prefs-panel h2 {
  font-size: 0.75rem;
  margin: 0 0 0.3rem 0;
}
.prefs-panel small {
  font-size: 0.6rem;
  color: var(--muted);
  display: block;
  margin-bottom: 0.35rem;
}
.prefs-panel button,
.prefs-panel label {
  font-size: 0.63rem;
}
.prefs-panel button {
  background: rgba(94,224,255,0.1);
  color: var(--text);
  border: 1px solid rgba(94,224,255,0.3);
  border-radius: 0.45rem;
  padding: 0.25rem 0.6rem;
  cursor: pointer;
  margin-right: 0.25rem;
}
footer {
  text-align: center;
  font-size: 0.6rem;
  color: rgba(255,255,255,0.35);
  margin-bottom: 1.2rem;
}
@media (max-width: 480px) {
  .lecture-header {
    gap: 0.5rem;
  }
  .emoji-block {
    font-size: 1.7rem;
    min-width: 2.6rem;
  }
  .lecture-title {
    font-size: 0.96rem;
  }
  .filters {
    width: 100%;
    flex-wrap: wrap;
    justify-content: flex-end;
  }
}
</style>
</head>
<body>
<div class="app-shell">
  <header class="header">
    <div class="title-block">
      <h1>Self-Paced Lecture Dashboard</h1>
      <small>Tap to open â†’ watch â†’ attendance â†’ make â‰¥10 cards</small>
    </div>
    <div class="filters">
      <button class="filter-btn active" data-filter="all">All (44)</button>
      <button class="filter-btn" data-filter="needWatch">Need to watch</button>
      <button class="filter-btn" data-filter="needCards">Need cards</button>
    </div>
    <div class="top-actions">
      <button class="icon-btn" id="expandToggle" title="Expand / collapse all">â‡µ</button>
      <button class="icon-btn" id="prefsBtn" title="Preferences / Backup">âš™</button>
    </div>
  </header>

  <main>
    <div id="lectureList" class="lecture-list"></div>
  </main>

  <footer>Saved to this browser. Use âš™ to export/import.</footer>

  <div class="prefs-panel" id="prefsPanel">
    <h2>Backup &amp; Sync</h2>
    <small>Download your progress as JSON and load it on another device.</small>
    <button id="downloadBtn">Download progress</button>
    <label for="uploadInput" style="cursor:pointer;color:var(--accent);text-decoration:underline;">Upload progressâ€¦</label>
    <input type="file" id="uploadInput" accept="application/json" style="display:none;" />
    <small id="prefsStatus"></small>
  </div>
</div>

<script>
const LECTURES = [
    { "id": 1, "date": "October 14", "title": "NR 123 Stroke: Central Nervous System Ischemia Self-paced Lecture (44:32)", "link": "https://acr.instructure.com/courses/411/assignments/37700" },
    { "id": 2, "date": "October 14", "title": "NR 112 Orbit Self-paced Lecture (46:54)", "link": "https://acr.instructure.com/courses/411/assignments/37683" },
    { "id": 3, "date": "October 15", "title": "NM 203 Introduction to Theranostics Self-Paced Lecture (33:26)", "link": "https://acr.instructure.com/courses/411/assignments/37719" },
    { "id": 4, "date": "October 15", "title": "NR 125 Degenerative and Inflammatory Diseases of the Spine Self-paced Lecture (42:01)", "link": "https://acr.instructure.com/courses/411/assignments/37701" },
    { "id": 5, "date": "October 15", "title": "NR 126 Neoplastic and Vascular Diseases of the Spine Self-paced Lecture (41:57)", "link": "https://acr.instructure.com/courses/411/assignments/37702" },
    { "id": 6, "date": "October 16", "title": "NR 203 Craniofacial Trauma Self-paced Lecture (41:54)", "link": "https://acr.instructure.com/courses/411/assignments/37711" },
    { "id": 7, "date": "October 16", "title": "NR 204 Temporal Bone Self-paced Lecture (55:44)", "link": "https://acr.instructure.com/courses/411/assignments/37712" },
    { "id": 8, "date": "October 16", "title": "CV 214-Spectrum of Coronary Artery Aneurysms Self-paced Lecture (35:52)", "link": "https://acr.instructure.com/courses/411/assignments/37733" },
    { "id": 9, "date": "October 17", "title": "CV 106 The Great Pretenders: Unusual Thoracic Lesions Self-paced Lecture", "link": "https://acr.instructure.com/courses/411/assignments/37724" },
    { "id": 10, "date": "October 20", "title": "CV 109-Thoracic Vasculitis: Imaging Clues and Collaborative Diagnosis Self-paced Lecture", "link": "https://acr.instructure.com/courses/411/assignments/37727" },
    { "id": 11, "date": "October 21", "title": "CV 105 Nuclear and Molecular Cardiovascular Imaging Self-paced Lecture (45:32)", "link": "https://acr.instructure.com/courses/411/assignments/37723" },
    { "id": 12, "date": "October 22", "title": "TH 205-Thoracic Metastatic Disease Self-paced Lecture (45:58)", "link": "https://acr.instructure.com/courses/411/assignments/37760" },
    { "id": 13, "date": "October 22", "title": "TH 203-The Many Faces of Bronchiectasis Self-paced Lecture (46:12)", "link": "https://acr.instructure.com/courses/411/assignments/37757" },
    { "id": 14, "date": "October 22", "title": "PD 101 Congenital Anomalies of the Kidney and Urinary Tract Self-paced Lecture (33:51)", "link": "https://acr.instructure.com/courses/411/assignments/37809" },
    { "id": 15, "date": "October 23", "title": "PD 111 - Pediatric Pelvic Masses Self-paced Lecture (47:34)", "link": "https://acr.instructure.com/courses/411/assignments/37824" },
    { "id": 16, "date": "October 23", "title": "PD 122 Brain and Spine Imaging for Head Trauma Self-paced Lecture (34:21)", "link": "https://acr.instructure.com/courses/411/assignments/37840" },
    { "id": 17, "date": "October 23", "title": "PD-CR 103 - Pediatric Hip, Case Review Self-paced Lecture (22:16)", "link": "https://acr.instructure.com/courses/411/assignments/37843" },
    { "id": 18, "date": "October 23", "title": "PD 102 - Pediatric Airway and Neck Self-paced Lecture (35:05)", "link": "https://acr.instructure.com/courses/411/assignments/37810" },
    { "id": 19, "date": "October 23", "title": "PD 104 Radiology of Child Abuse Self-paced Lecture (48:36)", "link": "https://acr.instructure.com/courses/411/assignments/37811" },
    { "id": 20, "date": "October 24", "title": "PD 121 Congenital Heart Disease Part 3: Chest Radiography with MR and CT Correlation Self-paced Lecture (1:02:19)", "link": "https://acr.instructure.com/courses/411/assignments/37839" },
    { "id": 21, "date": "October 27", "title": "GU 222 - Prostate MRI Self-paced Lecture (37:15)", "link": "https://acr.instructure.com/courses/411/assignments/38176" },
    { "id": 22, "date": "October 29", "title": "GI 209 Pancreatitis Self-paced Lecture", "link": "https://acr.instructure.com/courses/411/assignments/37889" },
    { "id": 23, "date": "October 29", "title": "GI 212 The Spleen Self-paced Lecture (48:01)", "link": "https://acr.instructure.com/courses/411/assignments/37894" },
    { "id": 24, "date": "October 29", "title": "GI 205 - Imaging of Biliary Disease Self-paced Lecture (44:45)", "link": "https://acr.instructure.com/courses/411/assignments/37882" },
    { "id": 25, "date": "October 31", "title": "GI 104 Imaging of Liver Metastases Self-paced Lecture (38:59)", "link": "https://acr.instructure.com/courses/411/assignments/37875" },
    { "id": 26, "date": "November 3", "title": "MS 115 Imaging of Ewing Sarcoma and Langerhans Cell Histiocytosis Self-paced Lecture (42:43)", "link": "https://acr.instructure.com/courses/411/assignments/37964" },
    { "id": 27, "date": "November 3", "title": "MS 101a Fundamental Concepts of Musculoskeletal Neoplasms: Radiographs Self-paced Lecture (1:15:16)", "link": "https://acr.instructure.com/courses/411/assignments/37929" },
    { "id": 28, "date": "November 3", "title": "MS 101b Fundamental Concepts of Musculoskeletal Neoplasms: CT and MRI Self-paced Lecture (1:09:54)", "link": "https://acr.instructure.com/courses/411/assignments/37930" },
    { "id": 29, "date": "November 3", "title": "MS 108 Skeletal Metastases, Myeloma, and Lymphoma Self-paced Lecture (42:27)", "link": "https://acr.instructure.com/courses/411/assignments/37949" },
    { "id": 30, "date": "November 4", "title": "MS 102 Osteonecrosis and Femoracetabular Impingement Self-paced Lecture (1:00:58)", "link": "https://acr.instructure.com/courses/411/assignments/37931" },
    { "id": 31, "date": "November 4", "title": "MS 109 Musculoskeletal Angiomatous Lesions Self-paced Lecture (1:08:10)", "link": "https://acr.instructure.com/courses/411/assignments/37950" },
    { "id": 32, "date": "November 4", "title": "MS 110 MSK Lipomatous Lesions Self-paced Lecture (1:08:53)", "link": "https://acr.instructure.com/courses/411/assignments/37951" },
    { "id": 33, "date": "November 5", "title": "MS 107 Paget Disease Self-paced Lecture (1:03:04)", "link": "https://acr.instructure.com/courses/411/assignments/37948" },
    { "id": 34, "date": "November 5", "title": "MS 116 MSK Manifestations of Chronic Renal Insufficiency, Osteomalacia, and Rickets Self-paced Lecture (1:06:05)", "link": "https://acr.instructure.com/courses/411/assignments/37965" },
    { "id": 35, "date": "November 5", "title": "MS 117 Crystal Deposition Diseases and Neuropathic Osteoarthropathy Self-paced Lecture (50:11)", "link": "https://acr.instructure.com/courses/411/assignments/37966" },
    { "id": 36, "date": "November 5", "title": "MS 201 MRI of Shoulder Instability Self-paced Lecture (36:06)", "link": "https://acr.instructure.com/courses/411/assignments/37995" },
    { "id": 37, "date": "November 6", "title": "MS 123 MRI of the Elbow Self-paced Lecture (41:52)", "link": "https://acr.instructure.com/courses/411/assignments/37981" },
    { "id": 38, "date": "November 6", "title": "MS 124 MRI of the Wrist Self-paced Lecture (58:43)", "link": "https://acr.instructure.com/courses/411/assignments/37982" },
    { "id": 39, "date": "November 6", "title": "MS 127 Musculoskeletal Ultrasound with MRI Correlation: Demonstration Self-paced Lecture (22:56)", "link": "https://acr.instructure.com/courses/411/assignments/37983" },
    { "id": 40, "date": "November 6", "title": "MS 134 Radiologic Assessment of Joint Replacement and Imaging of Bone Grafts Self-paced Lecture (1:02:03)", "link": "https://acr.instructure.com/courses/411/assignments/37994" },
    { "id": 41, "date": "November 7", "title": "BI 210 DCIS: Mammography and Ultrasound Self-paced Lecture (36:11)", "link": "https://acr.instructure.com/courses/411/assignments/38040" },
    { "id": 42, "date": "November 7", "title": "BI 211 DCIS: MRI Self-paced Lecture (23:15)", "link": "https://acr.instructure.com/courses/411/assignments/38041" },
    { "id": 43, "date": "November 7", "title": "BI 203 Breast Diseases in Young Women Self-paced Lecture (27:10)", "link": "https://acr.instructure.com/courses/411/assignments/38030" },
    { "id": 44, "date": "November 7", "title": "BI 204 Breast Disease in Males Self-paced Lecture (21:30)", "link": "https://acr.instructure.com/courses/411/assignments/38031" }
];

const STORAGE_KEY = "airpSelfPacedProgress_v1";
let progress = loadProgress();
let currentFilter = "all";
let expandAll = false;

function loadProgress() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : {};
  } catch {
    return {};
  }
}
function saveProgress(p) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(p));
}
function ensureProgressSkeleton() {
  LECTURES.forEach(l => {
    if (!progress[l.id]) {
      progress[l.id] = { watched: false, attendance: false, cards: 0, expanded: false };
    } else {
      if (progress[l.id].expanded === undefined) {
        progress[l.id].expanded = false;
      }
    }
  });
}
ensureProgressSkeleton();

function emojiFor(title) {
  if (title.startsWith("NR ")) return "ðŸ§ ðŸ“¡";
  if (title.startsWith("NM ")) return "ðŸ§¬ðŸ“·";
  if (title.startsWith("PD ") || title.startsWith("PD-CR")) return "ðŸ§’ðŸ«";
  if (title.startsWith("MS ") || title.startsWith("MS-")) return "ðŸ¦´ðŸƒ";
  if (title.startsWith("BI ") || title.startsWith("BI-")) return "ðŸŽ€ðŸ©»";
  if (title.startsWith("CV ") || title.startsWith("CV-")) return "â¤ï¸ðŸ«€";
  if (title.startsWith("TH ") || title.startsWith("TH-")) return "ðŸ«ðŸ’¨";
  if (title.startsWith("GU ") || title.startsWith("GU-")) return "ðŸ’§ðŸš½";
  if (title.startsWith("GI ") || title.startsWith("GI-")) return "ðŸ•ðŸ’©";
  return "ðŸ“º";
}

function render() {
  const list = document.getElementById("lectureList");
  list.innerHTML = "";
  LECTURES.forEach(lec => {
    const p = progress[lec.id];

    if (currentFilter === "needWatch" && p.watched) return;
    if (currentFilter === "needCards" && p.cards >= 10) return;

    const allDone = p.watched && p.attendance && p.cards >= 10;

    const card = document.createElement("div");
    card.className = "lecture-card" + (allDone ? " done-all" : "");
    card.dataset.id = lec.id;

    const isExpanded = expandAll ? true : !!p.expanded;
    card.dataset.expanded = isExpanded ? "true" : "false";

    if (p.cards >= 10) {
      card.classList.add("glow-green");
    } else if (p.watched && p.attendance) {
      card.classList.add("glow-blue");
    }

    const header = document.createElement("div");
    header.className = "lecture-header";

    const emojiEl = document.createElement("div");
    emojiEl.className = "emoji-block";
    emojiEl.textContent = emojiFor(lec.title);

    const textWrap = document.createElement("div");
    textWrap.className = "header-text";

    const titleEl = document.createElement("div");
    titleEl.className = "lecture-title";
    titleEl.textContent = lec.title;

    const meta = document.createElement("div");
    meta.className = "lecture-meta";

    const date = document.createElement("span");
    date.className = "badge-date";
    date.textContent = lec.date;
    meta.appendChild(date);

    const dots = document.createElement("div");
    dots.className = "status-dots";
    const dot1 = document.createElement("span");
    dot1.className = "st-dot" + (p.watched ? " st-done" : "");
    const dot2 = document.createElement("span");
    dot2.className = "st-dot" + (p.attendance ? " st-done" : "");
    const dot3 = document.createElement("span");
    dot3.className = "st-dot" + (p.cards >= 10 ? " st-done" : "");
    dots.append(dot1, dot2, dot3);
    meta.appendChild(dots);

    textWrap.appendChild(titleEl);
    textWrap.appendChild(meta);

    const chevron = document.createElement("div");
    chevron.className = "expand-indicator";
    chevron.textContent = "â€º";

    header.append(emojiEl, textWrap, chevron);
    card.appendChild(header);

    const body = document.createElement("div");
    body.className = "lecture-body";
    const inner = document.createElement("div");
    inner.className = "lecture-body-inner";

    if (allDone) {
      const tag = document.createElement("div");
      tag.className = "tag-status";
      tag.textContent = "Done âœ“";
      inner.appendChild(tag);
    }

    const link = document.createElement("div");
    link.className = "link-line";
    const a = document.createElement("a");
    a.href = lec.link;
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.textContent = lec.link;
    link.appendChild(a);
    inner.appendChild(link);

    const checklist = document.createElement("div");
    checklist.className = "checklist";

    const makeChk = (label, key) => {
      const l = document.createElement("label");
      l.className = "chk";
      const input = document.createElement("input");
      input.type = "checkbox";
      input.checked = !!p[key];
      input.addEventListener("click", ev => {
        ev.stopPropagation();
      });
      input.addEventListener("change", () => {
        progress[lec.id][key] = input.checked;
        progress[lec.id].expanded = true;
        saveProgress(progress);
        render();
      });
      const span = document.createElement("span");
      span.textContent = label;
      l.append(input, span);
      return l;
    };
    checklist.appendChild(makeChk("Watched", "watched"));
    checklist.appendChild(makeChk("Attendance", "attendance"));
    inner.appendChild(checklist);

    const cardsRow = document.createElement("div");
    cardsRow.className = "cards-row";

    const pill = document.createElement("span");
    pill.className = "cards-pill";
    pill.textContent = "Cards: " + (p.cards || 0) + "/10";
    cardsRow.appendChild(pill);

    const minus = document.createElement("button");
    minus.textContent = "âˆ’";
    minus.addEventListener("click", ev => {
      ev.stopPropagation();
      const cur = progress[lec.id].cards || 0;
      progress[lec.id].cards = Math.max(0, cur - 1);
      progress[lec.id].expanded = true;
      saveProgress(progress);
      render();
    });
    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.addEventListener("click", ev => {
      ev.stopPropagation();
      const cur = progress[lec.id].cards || 0;
      progress[lec.id].cards = Math.min(30, cur + 1);
      progress[lec.id].expanded = true;
      saveProgress(progress);
      render();
    });
    const ten = document.createElement("button");
    ten.textContent = "10";
    ten.title = "Mark 10 cards made";
    ten.addEventListener("click", ev => {
      ev.stopPropagation();
      progress[lec.id].cards = 10;
      progress[lec.id].expanded = true;
      saveProgress(progress);
      render();
    });

    cardsRow.append(minus, plus, ten);
    inner.appendChild(cardsRow);

    body.appendChild(inner);
    card.appendChild(body);

    header.addEventListener("click", () => {
      const isOpen = card.dataset.expanded === "true";
      progress[lec.id].expanded = !isOpen;
      saveProgress(progress);
      render();
    });

    list.appendChild(card);
  });
}

document.querySelectorAll(".filter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.addEventListener
    currentFilter = btn.dataset.filter;
    render();
  });
});
document.querySelectorAll(".filter-btn").forEach(b => b.onclick = () => {
  document.querySelectorAll(".filter-btn").forEach(bb => bb.classList.remove("active"));
  b.classList.add("active");
  currentFilter = b.dataset.filter;
  render();
});

const prefsBtn = document.getElementById("prefsBtn");
const prefsPanel = document.getElementById("prefsPanel");
prefsBtn.addEventListener("click", () => {
  prefsPanel.style.display = prefsPanel.style.display === "block" ? "none" : "block";
});

document.getElementById("downloadBtn").addEventListener("click", () => {
  const blob = new Blob([JSON.stringify(progress, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "airp-self-paced-progress.json";
  a.click();
  URL.revokeObjectURL(url);
  document.getElementById("prefsStatus").textContent = "Downloaded.";
  setTimeout(() => document.getElementById("prefsStatus").textContent = "", 4000);
});

document.getElementById("uploadInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);
      LECTURES.forEach(l => {
        if (!data[l.id]) data[l.id] = { watched: false, attendance: false, cards: 0, expanded: false };
        else if (data[l.id].expanded === undefined) data[l.id].expanded = false;
      });
      progress = data;
      saveProgress(progress);
      render();
      document.getElementById("prefsStatus").textContent = "Imported successfully.";
    } catch (err) {
      document.getElementById("prefsStatus").textContent = "Import failed.";
    }
    setTimeout(() => document.getElementById("prefsStatus").textContent = "", 4000);
  };
  reader.readAsText(file);
});

document.getElementById("expandToggle").addEventListener("click", () => {
  expandAll = !expandAll;
  if (expandAll) {
    LECTURES.forEach(l => {
      if (!progress[l.id]) progress[l.id] = { watched: false, attendance: false, cards: 0, expanded: true };
      else progress[l.id].expanded = true;
    });
  }
  saveProgress(progress);
  render();
});

render();
</script>
</body>
</html>
