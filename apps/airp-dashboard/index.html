<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AIRP Self-Paced Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0a0f16;
      --bg2: #111826;
      --panel: rgba(13, 19, 30, 0.7);
      --card: rgba(19, 27, 40, 0.9);
      --text: #edf4ff;
      --muted: #a3b2cc;
      --accent: #4dd0ff;
      --accent-soft: rgba(77, 208, 255, 0.12);
      --blue-glow: 0 0 20px 4px rgba(77, 166, 255, 0.35);
      --green-glow: 0 0 20px 4px rgba(77, 255, 166, 0.45);
      --radius-lg: 18px;
      --radius-md: 14px;
      --radius-sm: 10px;
      --gap: 1rem;
      --header-h: 62px;
      --danger: #ff6b6b;
    }
    * {
      box-sizing: border-box;
    }
    body {
      background: radial-gradient(circle at top, #162235, #06080d 55%);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(14px);
      background: rgba(6, 9, 15, 0.65);
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      gap: 1rem;
    }
    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title-block h1 {
      font-size: 1.05rem;
      margin: 0;
    }
    .title-block small {
      color: var(--muted);
      font-size: 0.7rem;
    }
    .filters {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }
    .filter-btn {
      background: rgba(11, 15, 23, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 999px;
      color: var(--muted);
      padding: 0.38rem 0.8rem 0.4rem;
      font-size: 0.65rem;
      cursor: pointer;
      transition: all 0.15s ease-out;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }
    .filter-btn.active {
      background: rgba(77, 208, 255, 0.14);
      color: #fff;
      border-color: rgba(77, 208, 255, 0.5);
    }
    .actions {
      display: flex;
      gap: 0.4rem;
    }
    .ghost-btn {
      background: rgba(6, 9, 15, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: 999px;
      color: var(--muted);
      padding: 0.4rem 0.7rem;
      cursor: pointer;
      font-size: 0.65rem;
    }
    main {
      width: min(950px, 100%);
      margin: 1rem auto 3.5rem;
      padding: 0 0.6rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    .lecture-card {
      background: radial-gradient(circle at top, rgba(21,31,48,0.9), rgba(10,11,12,0.4));
      border: 1px solid rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-lg);
      padding: 0.8rem 0.9rem 0.6rem;
      transition: all 0.12s ease-out;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      cursor: pointer;
    }
    .lecture-card.collapsed {
      padding-bottom: 0.5rem;
    }
    .lecture-card:hover {
      border-color: rgba(77, 208, 255, 0.4);
      background: radial-gradient(circle at top, rgba(39,57,87,0.85), rgba(10,11,12,0.25));
    }
    .lecture-card.blue-glow {
      box-shadow: var(--blue-glow);
      border-color: rgba(84, 173, 255, 0.6);
    }
    .lecture-card.green-glow {
      box-shadow: var(--green-glow);
      border-color: rgba(107, 255, 168, 0.8);
    }
    .lecture-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .emoji-block {
      font-size: 1.45rem;
      line-height: 1;
      margin-bottom: 0.15rem;
    }
    .lecture-title-block {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }
    .lecture-title {
      font-size: 0.9rem;
      font-weight: 600;
      line-height: 1.3;
    }
    .lecture-meta {
      font-size: 0.65rem;
      color: var(--muted);
    }
    .toggle-icon {
      font-size: 1.1rem;
      opacity: 0.6;
    }
    .lecture-body {
      margin-top: 0.6rem;
      border-top: 1px solid rgba(255, 255, 255, 0.022);
      padding-top: 0.55rem;
      display: none;
      cursor: default;
    }
    .lecture-card.expanded .lecture-body {
      display: block;
    }
    .check-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.65rem;
      margin-bottom: 0.4rem;
    }
    .check-item {
      background: rgba(3, 5, 9, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.03);
      border-radius: 999px;
      padding: 0.25rem 0.7rem 0.25rem 0.35rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      min-height: 36px;
    }
    .check-item input[type="checkbox"] {
      width: 1.1rem;
      height: 1.1rem;
      accent-color: var(--accent);
      cursor: pointer;
    }
    .check-label-text {
      font-size: 0.75rem;
      cursor: pointer;
    }
    .link-row a {
      color: #98dcff;
      font-size: 0.7rem;
      text-decoration: none;
      word-break: break-all;
    }
    .link-row a:hover {
      text-decoration: underline;
    }
    .cards-control {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      margin-top: 0.35rem;
    }
    .cards-control label {
      font-size: 0.67rem;
      color: var(--muted);
    }
    .cards-control input[type="number"] {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 0.25rem 0.4rem;
      width: 4.3rem;
      color: #fff;
      font-size: 0.75rem;
    }
    .cards-note {
      font-size: 0.6rem;
      color: var(--muted);
      margin-top: 0.2rem;
    }
    .hidden-panel {
      display: none;
      position: fixed;
      right: 1rem;
      top: calc(var(--header-h) + 0.6rem);
      background: rgba(7, 10, 16, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: 14px;
      padding: 0.6rem;
      width: 220px;
      z-index: 40;
      backdrop-filter: blur(8px);
    }
    .hidden-panel textarea {
      width: 100%;
      min-height: 90px;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: 6px;
      color: #fff;
      font-size: 0.6rem;
      font-family: ui-monospace, SFMono-Regular, SFMono-Medium, SFMono-Regular, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .panel-row {
      display: flex;
      gap: 0.4rem;
      margin-top: 0.4rem;
    }
    .small-btn {
      background: rgba(77, 208, 255, 0.3);
      border: 1px solid rgba(77, 208, 255, 0.5);
      border-radius: 6px;
      font-size: 0.6rem;
      color: #fff;
      padding: 0.3rem 0.5rem;
      cursor: pointer;
      flex: 1;
      text-align: center;
    }
    @media (max-width: 540px) {
      header {
        flex-wrap: wrap;
        height: auto;
        padding-bottom: 0.5rem;
      }
      main {
        padding: 0 0.4rem 1rem;
      }
      .lecture-head {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="title-block">
      <h1>AIRP Self-Paced Tracker</h1>
      <small>Watch ‚Üí Mark attendance ‚Üí Make ‚â•10 Anki cards</small>
    </div>
    <div class="filters" id="filters">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="need-watch">Need to watch</button>
      <button class="filter-btn" data-filter="need-cards">Need cards</button>
    </div>
    <div class="actions">
      <button class="ghost-btn" id="toggleAll">Expand all</button>
      <button class="ghost-btn" id="dataBtn">‚öôÔ∏è Data</button>
    </div>
  </header>

  <main id="cards"></main>

  <div class="hidden-panel" id="dataPanel">
    <div style="font-size:0.65rem;margin-bottom:0.3rem;">Export / Import progress</div>
    <textarea id="dataText" spellcheck="false"></textarea>
    <div class="panel-row">
      <button class="small-btn" id="exportBtn">Export</button>
      <button class="small-btn" id="importBtn">Import</button>
    </div>
  </div>

  <script>
    // 44 self-paced lectures, sorted by DT, IDs sequential, links as per your pattern
    const LECTURES = [
      {"id":"lec1","title":"NR 123 Nontraumatic Neuroimaging Review ‚Äì Self-Paced","date":"Oct 6","link":"https://acr.instructure.com/courses/411/assignments/37700"},
      {"id":"lec2","title":"Body 101 Body CT: Liver and Gallbladder ‚Äì Self-Paced","date":"Oct 8","link":"https://acr.instructure.com/courses/411/assignments/37701"},
      {"id":"lec3","title":"Breast 110 Screening Mammography Essentials ‚Äì Self-Paced","date":"Oct 9","link":"https://acr.instructure.com/courses/411/assignments/37702"},
      {"id":"lec4","title":"Chest 115 HRCT of Diffuse Lung Disease ‚Äì Self-Paced","date":"Oct 10","link":"https://acr.instructure.com/courses/411/assignments/37703"},
      {"id":"lec5","title":"NR 126 Neoplastic and Vascular Diseases of the Brain ‚Äì Self-Paced","date":"Oct 13","link":"https://acr.instructure.com/courses/411/assignments/37704"},
      {"id":"lec6","title":"Peds 130 Pediatric Chest and Abdomen ‚Äì Self-Paced","date":"Oct 14","link":"https://acr.instructure.com/courses/411/assignments/37705"},
      {"id":"lec7","title":"GU 140 Male and Female Pelvis Imaging ‚Äì Self-Paced","date":"Oct 15","link":"https://acr.instructure.com/courses/411/assignments/37706"},
      {"id":"lec8","title":"MSK 150 Fundamentals of Musculoskeletal Imaging ‚Äì Self-Paced","date":"Oct 16","link":"https://acr.instructure.com/courses/411/assignments/37707"},
      {"id":"lec9","title":"Body 160 Pancreas and Biliary Tract ‚Äì Self-Paced","date":"Oct 17","link":"https://acr.instructure.com/courses/411/assignments/37708"},
      {"id":"lec10","title":"Chest 170 Pulmonary and Mediastinal Masses ‚Äì Self-Paced","date":"Oct 20","link":"https://acr.instructure.com/courses/411/assignments/37709"},
      {"id":"lec11","title":"Breast 175 Diagnostic Mammography and US Correlation ‚Äì Self-Paced","date":"Oct 21","link":"https://acr.instructure.com/courses/411/assignments/37710"},
      {"id":"lec12","title":"NR 180 Advanced Head and Neck Imaging ‚Äì Self-Paced","date":"Oct 22","link":"https://acr.instructure.com/courses/411/assignments/37711"},
      {"id":"lec13","title":"Body 185 GI Tract and Mesentery ‚Äì Self-Paced","date":"Oct 23","link":"https://acr.instructure.com/courses/411/assignments/37712"},
      {"id":"lec14","title":"Peds 190 Congenital and Developmental Abnormalities ‚Äì Self-Paced","date":"Oct 24","link":"https://acr.instructure.com/courses/411/assignments/37713"},
      {"id":"lec15","title":"MSK 195 Arthritis and Joint Disorders ‚Äì Self-Paced","date":"Oct 27","link":"https://acr.instructure.com/courses/411/assignments/37714"},
      {"id":"lec16","title":"Body 200 Adrenal, Spleen, and Retroperitoneum ‚Äì Self-Paced","date":"Oct 28","link":"https://acr.instructure.com/courses/411/assignments/37715"},
      {"id":"lec17","title":"Chest 205 Cardiac and Great Vessel CT/MR ‚Äì Self-Paced","date":"Oct 29","link":"https://acr.instructure.com/courses/411/assignments/37716"},
      {"id":"lec18","title":"NR 210 Spine Imaging: Degenerative and Postop ‚Äì Self-Paced","date":"Oct 30","link":"https://acr.instructure.com/courses/411/assignments/37717"},
      {"id":"lec19","title":"Breast 215 MRI of the Breast ‚Äì Self-Paced","date":"Oct 31","link":"https://acr.instructure.com/courses/411/assignments/37718"},
      {"id":"lec20","title":"GU 220 Renal and Urothelial Tumors ‚Äì Self-Paced","date":"Nov 3","link":"https://acr.instructure.com/courses/411/assignments/37719"},
      {"id":"lec21","title":"Peds 225 Pediatric Neuro and Spine ‚Äì Self-Paced","date":"Nov 4","link":"https://acr.instructure.com/courses/411/assignments/37720"},
      {"id":"lec22","title":"Body 230 Multiphase Liver Lesions and LI-RADS ‚Äì Self-Paced","date":"Nov 5","link":"https://acr.instructure.com/courses/411/assignments/37721"},
      {"id":"lec23","title":"MSK 235 Trauma and Sports Injuries ‚Äì Self-Paced","date":"Nov 6","link":"https://acr.instructure.com/courses/411/assignments/37722"},
      {"id":"lec24","title":"Chest 240 Infections and Immunocompromised Host ‚Äì Self-Paced","date":"Nov 7","link":"https://acr.instructure.com/courses/411/assignments/37723"},
      {"id":"lec25","title":"NR 245 Emergency and Stroke Imaging ‚Äì Self-Paced","date":"Nov 10","link":"https://acr.instructure.com/courses/411/assignments/37724"},
      {"id":"lec26","title":"Body 250 Female Reproductive Tract ‚Äì Self-Paced","date":"Nov 11","link":"https://acr.instructure.com/courses/411/assignments/37725"},
      {"id":"lec27","title":"Breast 255 Problem-Solving with US and MRI ‚Äì Self-Paced","date":"Nov 12","link":"https://acr.instructure.com/courses/411/assignments/37726"},
      {"id":"lec28","title":"GU 260 Prostate and Scrotum ‚Äì Self-Paced","date":"Nov 13","link":"https://acr.instructure.com/courses/411/assignments/37727"},
      {"id":"lec29","title":"Peds 265 Pediatric GU and Pelvis ‚Äì Self-Paced","date":"Nov 14","link":"https://acr.instructure.com/courses/411/assignments/37728"},
      {"id":"lec30","title":"MSK 270 Tumors of Bone and Soft Tissue ‚Äì Self-Paced","date":"Nov 17","link":"https://acr.instructure.com/courses/411/assignments/37729"},
      {"id":"lec31","title":"Body 275 Bowel Obstruction and Ischemia ‚Äì Self-Paced","date":"Nov 18","link":"https://acr.instructure.com/courses/411/assignments/37730"},
      {"id":"lec32","title":"Chest 280 Pulmonary Embolism and Vascular Disorders ‚Äì Self-Paced","date":"Nov 19","link":"https://acr.instructure.com/courses/411/assignments/37731"},
      {"id":"lec33","title":"NR 285 Pediatric Neuro ‚Äì Self-Paced","date":"Nov 20","link":"https://acr.instructure.com/courses/411/assignments/37732"},
      {"id":"lec34","title":"MSK 290 MSK Manifestations of Chronic Renal Insufficiency, Osteomalacia, and Rickets ‚Äì Self-Paced","date":"Nov 21","link":"https://acr.instructure.com/courses/411/assignments/37733"},
      {"id":"lec35","title":"Body 295 Hepatobiliary Tumors and Transplant ‚Äì Self-Paced","date":"Nov 24","link":"https://acr.instructure.com/courses/411/assignments/37734"},
      {"id":"lec36","title":"Breast 300 Challenging Cases and Pitfalls ‚Äì Self-Paced","date":"Nov 25","link":"https://acr.instructure.com/courses/411/assignments/37735"},
      {"id":"lec37","title":"Chest 305 Postoperative Thoracic Imaging ‚Äì Self-Paced","date":"Nov 26","link":"https://acr.instructure.com/courses/411/assignments/37736"},
      {"id":"lec38","title":"GU 310 Adrenal, Retroperitoneum, and Lymphatics ‚Äì Self-Paced","date":"Dec 1","link":"https://acr.instructure.com/courses/411/assignments/37737"},
      {"id":"lec39","title":"Peds 315 Nonaccidental Trauma and Emergencies ‚Äì Self-Paced","date":"Dec 2","link":"https://acr.instructure.com/courses/411/assignments/37738"},
      {"id":"lec40","title":"MSK 320 Arthritides, Crystal Deposition, and Spondyloarthropathies ‚Äì Self-Paced","date":"Dec 3","link":"https://acr.instructure.com/courses/411/assignments/37739"},
      {"id":"lec41","title":"Body 325 Peritoneum, Mesentery, and Abdominal Wall ‚Äì Self-Paced","date":"Dec 4","link":"https://acr.instructure.com/courses/411/assignments/37740"},
      {"id":"lec42","title":"NR 330 Orbit, Skull Base, and Temporal Bone ‚Äì Self-Paced","date":"Dec 5","link":"https://acr.instructure.com/courses/411/assignments/37741"},
      {"id":"lec43","title":"Chest 335 CT/MR of the Mediastinum and Pleura ‚Äì Self-Paced","date":"Dec 8","link":"https://acr.instructure.com/courses/411/assignments/37742"},
      {"id":"lec44","title":"Body 340 Oncologic and Post-Treatment Imaging ‚Äì Self-Paced","date":"Dec 9","link":"https://acr.instructure.com/courses/411/assignments/37743"}
    ];

    // emoji suggestions to make it look less intimidating
    function emojiFor(title) {
      const t = title.toLowerCase();
      if (t.includes("breast")) return "üéÄü©ª";
      if (t.includes("msk")) return "ü¶¥‚ú®";
      if (t.includes("peds")) return "üßíüì∏";
      if (t.includes("chest") || t.includes("pulm")) return "ü´Å";
      if (t.includes("gu") || t.includes("pelvis") || t.includes("uro")) return "üöª";
      if (t.includes("body") || t.includes("liver") || t.includes("abd")) return "ü´Äüì¶";
      if (t.includes("nr") || t.includes("neuro") || t.includes("head")) return "üß†";
      return "üì∫";
    }

    const STORAGE_KEY = "airp_self_paced_progress_v1";

    function loadProgress() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch (e) {
        return {};
      }
    }

    function saveProgress(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    const progress = loadProgress();

    const cardsContainer = document.getElementById("cards");

    function buildCard(lec) {
      const card = document.createElement("div");
      card.className = "lecture-card collapsed";
      card.dataset.lecId = lec.id;

      const head = document.createElement("div");
      head.className = "lecture-head";

      const emoji = document.createElement("div");
      emoji.className = "emoji-block";
      emoji.textContent = emojiFor(lec.title);

      const titleBlock = document.createElement("div");
      titleBlock.className = "lecture-title-block";

      const title = document.createElement("div");
      title.className = "lecture-title";
      title.textContent = lec.title;

      const meta = document.createElement("div");
      meta.className = "lecture-meta";
      meta.textContent = lec.date ? `Due ${lec.date}` : "Self-paced";

      titleBlock.appendChild(title);
      titleBlock.appendChild(meta);

      const togg = document.createElement("div");
      togg.className = "toggle-icon";
      togg.textContent = "‚ñ∏";

      head.appendChild(emoji);
      head.appendChild(titleBlock);
      head.appendChild(togg);

      const body = document.createElement("div");
      body.className = "lecture-body";
      body.addEventListener("click", e => e.stopPropagation());

      // checkboxes row
      const checkRow = document.createElement("div");
      checkRow.className = "check-row";

      const st = progress[lec.id] || { watched: false, attendance: false, cards: 0 };

      // watch
      const watchItem = document.createElement("label");
      watchItem.className = "check-item";
      const watchCb = document.createElement("input");
      watchCb.type = "checkbox";
      watchCb.checked = !!st.watched;
      watchCb.addEventListener("change", () => {
        updateState(lec.id, { watched: watchCb.checked });
        updateGlow(card, lec.id);
        applyCurrentFilter();
      });
      const watchTxt = document.createElement("span");
      watchTxt.className = "check-label-text";
      watchTxt.textContent = "Watched";
      watchItem.appendChild(watchCb);
      watchItem.appendChild(watchTxt);

      // attendance
      const attItem = document.createElement("label");
      attItem.className = "check-item";
      const attCb = document.createElement("input");
      attCb.type = "checkbox";
      attCb.checked = !!st.attendance;
      attCb.addEventListener("change", () => {
        updateState(lec.id, { attendance: attCb.checked });
        updateGlow(card, lec.id);
        applyCurrentFilter();
      });
      const attTxt = document.createElement("span");
      attTxt.className = "check-label-text";
      attTxt.textContent = "Attendance marked";
      attItem.appendChild(attCb);
      attItem.appendChild(attTxt);

      checkRow.appendChild(watchItem);
      checkRow.appendChild(attItem);

      const linkRow = document.createElement("div");
      linkRow.className = "link-row";
      const link = document.createElement("a");
      link.href = lec.link;
      link.target = "_blank";
      link.rel = "noreferrer";
      link.textContent = "Open self-paced lecture ‚Üí";
      linkRow.appendChild(link);

      // cards control
      const cardsControl = document.createElement("div");
      cardsControl.className = "cards-control";
      const cardsLabel = document.createElement("label");
      cardsLabel.textContent = "Anki cards made:";
      const cardsInput = document.createElement("input");
      cardsInput.type = "number";
      cardsInput.min = "0";
      cardsInput.value = st.cards || 0;
      cardsInput.addEventListener("input", () => {
        const val = parseInt(cardsInput.value, 10) || 0;
        updateState(lec.id, { cards: val });
        updateGlow(card, lec.id);
        applyCurrentFilter();
      });
      cardsControl.appendChild(cardsLabel);
      cardsControl.appendChild(cardsInput);

      const cardsNote = document.createElement("div");
      cardsNote.className = "cards-note";
      cardsNote.textContent = "Glow turns green when you hit ‚â• 10.";

      body.appendChild(checkRow);
      body.appendChild(linkRow);
      body.appendChild(cardsControl);
      body.appendChild(cardsNote);

      card.appendChild(head);
      card.appendChild(body);

      // expand / collapse
      card.addEventListener("click", () => {
        const expanded = card.classList.contains("expanded");
        if (expanded) {
          card.classList.remove("expanded");
          card.classList.add("collapsed");
          togg.textContent = "‚ñ∏";
        } else {
          card.classList.remove("collapsed");
          card.classList.add("expanded");
          togg.textContent = "‚ñæ";
        }
      });

      // initial glow
      updateGlow(card, lec.id);

      return card;
    }

    function updateState(id, partial) {
      const prev = progress[id] || { watched: false, attendance: false, cards: 0 };
      const next = { ...prev, ...partial };
      progress[id] = next;
      saveProgress(progress);
    }

    function updateGlow(card, id) {
      const st = progress[id] || {};
      card.classList.remove("blue-glow", "green-glow");
      const watched = !!st.watched;
      const attendance = !!st.attendance;
      const cards = st.cards || 0;
      if (cards >= 10) {
        card.classList.add("green-glow");
      } else if (watched && attendance) {
        card.classList.add("blue-glow");
      }
    }

    // render cards
    LECTURES.forEach(lec => {
      const card = buildCard(lec);
      cardsContainer.appendChild(card);
    });

    // filters
    let currentFilter = "all";
    const filterEls = document.querySelectorAll(".filter-btn");
    filterEls.forEach(btn => {
      btn.addEventListener("click", () => {
        filterEls.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentFilter = btn.dataset.filter;
        applyCurrentFilter();
      });
    });

    function applyCurrentFilter() {
      const cards = document.querySelectorAll(".lecture-card");
      cards.forEach(card => {
        const id = card.dataset.lecId;
        const st = progress[id] || { watched: false, attendance: false, cards: 0 };
        let show = true;
        if (currentFilter === "need-watch") {
          show = !(st.watched && st.attendance);
        } else if (currentFilter === "need-cards") {
          show = st.cards < 10;
        }
        card.style.display = show ? "block" : "none";
      });
    }

    // expand / collapse all
    const toggleAllBtn = document.getElementById("toggleAll");
    let allExpanded = false;
    toggleAllBtn.addEventListener("click", () => {
      const cards = document.querySelectorAll(".lecture-card");
      allExpanded = !allExpanded;
      cards.forEach(card => {
        const icon = card.querySelector(".toggle-icon");
        if (allExpanded) {
          card.classList.add("expanded");
          card.classList.remove("collapsed");
          icon.textContent = "‚ñæ";
        } else {
          card.classList.add("collapsed");
          card.classList.remove("expanded");
          icon.textContent = "‚ñ∏";
        }
      });
      toggleAllBtn.textContent = allExpanded ? "Collapse all" : "Expand all";
    });

    // data panel
    const dataBtn = document.getElementById("dataBtn");
    const dataPanel = document.getElementById("dataPanel");
    const dataText = document.getElementById("dataText");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");

    dataBtn.addEventListener("click", () => {
      const isOpen = dataPanel.style.display === "block";
      dataPanel.style.display = isOpen ? "none" : "block";
      if (!isOpen) {
        dataText.value = JSON.stringify(progress, null, 2);
      }
    });

    exportBtn.addEventListener("click", () => {
      dataText.value = JSON.stringify(progress, null, 2);
    });

    importBtn.addEventListener("click", () => {
      try {
        const obj = JSON.parse(dataText.value);
        Object.assign(progress, obj);
        saveProgress(progress);
        // re-apply glow + filter
        document.querySelectorAll(".lecture-card").forEach(card => {
          updateGlow(card, card.dataset.lecId);
        });
        applyCurrentFilter();
        alert("Imported.");
      } catch (e) {
        alert("Invalid JSON");
      }
    });

    // initial filter
    applyCurrentFilter();
  </script>
</body>
</html>