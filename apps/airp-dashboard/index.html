<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Self-Paced AIRP Tracker (Cozy)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root {
  --bg: #0b1017;
  --bg2: #121927;
  --panel: rgba(13, 18, 28, 0.9);
  --accent: #5ee0ff;
  --accent-soft: rgba(94, 224, 255, 0.1);
  --accent2: #ff77c8;
  --text: #edf4ff;
  --muted: #9aa6bc;
  --success: #77ffc4;
  --radius-lg: 1.4rem;
  --radius-sm: 0.8rem;
  --gap: 1rem;
  --shadow: 0 16px 40px rgba(0,0,0,0.25);
}
*,
*::before,
*::after {
  box-sizing: border-box;
}
body {
  margin: 0;
  background: radial-gradient(circle at 0% 0%, rgba(94,224,255,0.12), rgba(0,0,0,0)) fixed, #080b10;
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.4;
}
.app-shell {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
.header {
  position: sticky;
  top: 0;
  backdrop-filter: blur(16px);
  background: rgba(9, 12, 18, 0.9);
  border-bottom: 1px solid rgba(255,255,255,0.01);
  padding: 0.6rem 1rem 0.55rem 1rem;
  z-index: 20;
  display: flex;
  gap: 0.6rem;
  align-items: center;
}
.title-block h1 {
  font-size: 1.15rem;
  margin: 0;
  font-weight: 600;
}
.title-block small {
  font-size: 0.65rem;
  color: var(--muted);
}
.filters {
  display: flex;
  gap: 0.35rem;
  margin-left: auto;
}
.filter-btn {
  background: rgba(255,255,255,0.01);
  border: 1px solid transparent;
  border-radius: 999px;
  padding: 0.25rem 0.7rem 0.35rem 0.7rem;
  font-size: 0.7rem;
  color: var(--muted);
  cursor: pointer;
}
.filter-btn.active {
  background: rgba(94,224,255,0.14);
  color: var(--text);
  border-color: rgba(94,224,255,0.24);
  box-shadow: 0 0 14px rgba(94,224,255,0.3);
}
.top-actions {
  display: flex;
  gap: 0.35rem;
  margin-left: 0.3rem;
}
.icon-btn {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.03);
  width: 30px;
  height: 30px;
  border-radius: 999px;
  display: grid;
  place-items: center;
  cursor: pointer;
  color: var(--text);
  transition: 0.1s ease-out;
  font-size: 0.9rem;
}
.icon-btn:hover {
  background: rgba(255,255,255,0.1);
}
main {
  max-width: 650px;
  width: 100%;
  margin: 0 auto;
  padding: 1rem 0.6rem 2rem 0.6rem;
}
.lecture-list {
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
}
.lecture-card {
  background: rgba(13, 18, 28, 0.82);
  border: 1px solid rgba(255,255,255,0.016);
  border-radius: 1.1rem;
  box-shadow: 0 12px 25px rgba(0,0,0,0.12);
  overflow: hidden;
  transition: 0.12s ease-out;
}
.lecture-card.done-all {
  border: 1px solid rgba(119,255,196,0.4);
  box-shadow: 0 0 20px rgba(119,255,196,0.06);
}
.lecture-header {
  padding: 0.75rem 0.8rem 0.75rem 0.9rem;
  display: flex;
  gap: 0.7rem;
  align-items: center;
  cursor: pointer;
}
.emoji-block {
  font-size: 1.6rem;
  line-height: 1;
  min-width: 3rem;
  text-align: center;
}
.header-text {
  flex: 1;
}
.lecture-title {
  font-size: 0.93rem;
  font-weight: 600;
  line-height: 1.25;
}
.lecture-meta {
  display: flex;
  gap: 0.4rem;
  align-items: center;
  margin-top: 0.25rem;
}
.badge-date {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 999px;
  padding: 0.2rem 0.55rem 0.3rem 0.55rem;
  font-size: 0.6rem;
  color: var(--muted);
}
.status-dots {
  display: flex;
  gap: 0.2rem;
}
.st-dot {
  width: 9px;
  height: 9px;
  border-radius: 999px;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.04);
}
.st-done {
  background: rgba(119,255,196,1);
  border: none;
}
.expand-indicator {
  font-size: 1.1rem;
  color: rgba(237,244,255,0.65);
  transition: transform 0.12s ease-out;
}
.lecture-card[data-expanded="true"] .expand-indicator {
  transform: rotate(90deg);
}
.lecture-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.15s ease-out;
  background: rgba(4,5,7,0.1);
}
.lecture-card[data-expanded="true"] .lecture-body {
  max-height: 400px; /* plenty */
}
.lecture-body-inner {
  padding: 0.5rem 1rem 0.9rem 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.55rem;
  font-size: 0.78rem;
}
.link-line a {
  color: var(--accent);
  text-decoration: none;
  word-break: break-all;
}
.link-line a:hover {
  text-decoration: underline;
}
.checklist {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}
.chk {
  background: rgba(255,255,255,0.015);
  border: 1px solid rgba(255,255,255,0.015);
  border-radius: 0.6rem;
  padding: 0.25rem 0.55rem 0.3rem;
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.69rem;
  cursor: pointer;
}
.chk input {
  width: 0.7rem;
  height: 0.7rem;
  accent-color: var(--accent);
  margin: 0;
}
.cards-row {
  display: flex;
  gap: 0.4rem;
  align-items: center;
  font-size: 0.69rem;
}
.cards-pill {
  background: rgba(94,224,255,0.12);
  border: 1px solid rgba(94,224,255,0.3);
  border-radius: 999px;
  padding: 0.2rem 0.6rem 0.25rem;
}
.cards-row button {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 0.4rem;
  width: 22px;
  height: 22px;
  color: var(--text);
  font-size: 0.7rem;
  cursor: pointer;
}
.cards-row button:hover {
  background: rgba(255,255,255,0.12);
}
.tag-status {
  font-size: 0.6rem;
  background: rgba(119,255,196,0.1);
  border: 1px solid rgba(119,255,196,0.4);
  border-radius: 999px;
  padding: 0.12rem 0.5rem 0.2rem;
  color: #e5fff6;
}
.prefs-panel {
  position: fixed;
  top: 58px;
  right: 0.9rem;
  width: min(360px, 94vw);
  background: rgba(5,7,10,0.9);
  border: 1px solid rgba(255,255,255,0.04);
  border-radius: 1rem;
  padding: 0.75rem;
  box-shadow: 0 15px 30px rgba(0,0,0,0.25);
  z-index: 30;
  display: none;
}
.prefs-panel h2 {
  font-size: 0.75rem;
  margin: 0 0 0.3rem 0;
}
.prefs-panel small {
  font-size: 0.6rem;
  color: var(--muted);
  display: block;
  margin-bottom: 0.35rem;
}
.prefs-panel button,
.prefs-panel label {
  font-size: 0.63rem;
}
.prefs-panel button {
  background: rgba(94,224,255,0.1);
  color: var(--text);
  border: 1px solid rgba(94,224,255,0.3);
  border-radius: 0.45rem;
  padding: 0.25rem 0.6rem;
  cursor: pointer;
  margin-right: 0.25rem;
}
footer {
  text-align: center;
  font-size: 0.6rem;
  color: rgba(255,255,255,0.35);
  margin-bottom: 1.2rem;
}
@media (max-width: 480px) {
  .lecture-header {
    gap: 0.5rem;
  }
  .emoji-block {
    font-size: 1.45rem;
    min-width: 2.6rem;
  }
  .lecture-title {
    font-size: 0.9rem;
  }
  .filters {
    width: 100%;
    flex-wrap: wrap;
    justify-content: flex-end;
  }
}
</style>
</head>
<body>
<div class="app-shell">
  <header class="header">
    <div class="title-block">
      <h1>Self-Paced Lecture Dashboard</h1>
      <small>Tap to open a lecture â†’ watch â†’ attendance â†’ â‰¥10 cards</small>
    </div>
    <div class="filters">
      <button class="filter-btn active" data-filter="all">All (44)</button>
      <button class="filter-btn" data-filter="needWatch">Need to watch</button>
      <button class="filter-btn" data-filter="needCards">Need cards</button>
    </div>
    <div class="top-actions">
      <button class="icon-btn" id="expandToggle" title="Expand / collapse all">â‡µ</button>
      <button class="icon-btn" id="prefsBtn" title="Preferences / Backup">âš™</button>
    </div>
  </header>

  <main>
    <div id="lectureList" class="lecture-list"></div>
  </main>

  <footer>Saved to this browser. Use âš™ to export/import.</footer>

  <div class="prefs-panel" id="prefsPanel">
    <h2>Backup &amp; Sync</h2>
    <small>Download your progress as JSON and load it on another device.</small>
    <button id="downloadBtn">Download progress</button>
    <label for="uploadInput" style="cursor:pointer;color:var(--accent);text-decoration:underline;">Upload progressâ€¦</label>
    <input type="file" id="uploadInput" accept="application/json" style="display:none;" />
    <small id="prefsStatus"></small>
  </div>
</div>

<script>
const LECTURES = [
  { "id": 1, "date": "October 14", "title": "NR 123 Stroke: Central Nervous System Ischemia Self-paced Lecture (44:32)", "link": "https://acr.instructure.com/courses/411/assignments/37700" },
  { "id": 2, "date": "October 14", "title": "NR 112 Orbit Self-paced Lecture (46:54)", "link": "https://acr.instructure.com/courses/411/assignments/37683" },
  { "id": 3, "date": "October 15", "title": "NM 203 Introduction to Theranostics Self-Paced Lecture (33:26)", "link": "https://acr.instructure.com/courses/411/assignments/37719" },
  { "id": 4, "date": "October 15", "title": "NR 125 Degenerative and Inflammatory Diseases of the Spine Self-paced Lecture (39:33)", "link": "https://acr.instructure.com/courses/411/assignments/37708" },
  { "id": 5, "date": "October 15", "title": "NR 215 Imaging the Orbital Inflammatory and Infectious Diseases Self-paced Lecture (29:38)", "link": "https://acr.instructure.com/courses/411/assignments/37697" },
  { "id": 6, "date": "October 15", "title": "NR 212 MR and CT Evaluation of the Temporal Bone Self-paced Lecture (37:16)", "link": "https://acr.instructure.com/courses/411/assignments/37709" },
  { "id": 7, "date": "October 15", "title": "NR 206 Cystic and Solid Lesions of the Jaw Self-paced Lecture (33:11)", "link": "https://acr.instructure.com/courses/411/assignments/37701" },
  { "id": 8, "date": "October 16", "title": "PE 102 Chest Imaging in Children Self-paced Lecture (33:21)", "link": "https://acr.instructure.com/courses/411/assignments/37721" },
  { "id": 9, "date": "October 16", "title": "PE 111 Pediatric Genitourinary Imaging Self-paced Lecture (38:54)", "link": "https://acr.instructure.com/courses/411/assignments/37723" },
  { "id": 10, "date": "October 16", "title": "PE 101 Pediatric Neuroradiology Self-paced Lecture (32:39)", "link": "https://acr.instructure.com/courses/411/assignments/37720" },
  { "id": 11, "date": "October 16", "title": "NR 114 Paranasal Sinuses and the Face Self-paced Lecture (36:34)", "link": "https://acr.instructure.com/courses/411/assignments/37684" },
  { "id": 12, "date": "October 16", "title": "NR 126 Congenital Anomalies of the Brain Self-paced Lecture (46:58)", "link": "https://acr.instructure.com/courses/411/assignments/37710" },
  { "id": 13, "date": "October 20", "title": "MS 105 Soft Tissue Masses Self-paced Lecture (48:48)", "link": "https://acr.instructure.com/courses/411/assignments/37718" },
  { "id": 14, "date": "October 20", "title": "MS 104 Osteochondritis Dissecans, Osteochondral Lesions and Patellofemoral Pathology Self-paced Lecture (29:52)", "link": "https://acr.instructure.com/courses/411/assignments/37717" },
  { "id": 15, "date": "October 20", "title": "MS 103 Internal Derangements of the Knee Self-paced Lecture (27:25)", "link": "https://acr.instructure.com/courses/411/assignments/37716" },
  { "id": 16, "date": "October 20", "title": "MS 222 Scrotal Pathology Self-paced Lecture (33:02)", "link": "https://acr.instructure.com/courses/411/assignments/37688" },
  { "id": 17, "date": "October 20", "title": "MS 220 The Arthritic Knee Self-paced Lecture (26:51)", "link": "https://acr.instructure.com/courses/411/assignments/37686" },
  { "id": 18, "date": "October 21", "title": "MS 101 Anatomy and Pathology of the Shoulder Self-paced Lecture (35:09)", "link": "https://acr.instructure.com/courses/411/assignments/37714" },
  { "id": 19, "date": "October 21", "title": "MS 221 Sports Injuries in the Young Self-paced Lecture (31:43)", "link": "https://acr.instructure.com/courses/411/assignments/37687" },
  { "id": 20, "date": "October 21", "title": "MS 219 Knee and Shoulder Injuries in Athletes Self-paced Lecture (50:45)", "link": "https://acr.instructure.com/courses/411/assignments/37685" },
  { "id": 21, "date": "October 21", "title": "MS 102 Anatomy and Pathology of the Elbow Self-paced Lecture (32:03)", "link": "https://acr.instructure.com/courses/411/assignments/37715" },
  { "id": 22, "date": "October 21", "title": "MS 118 Introduction to MR Imaging of the Musculoskeletal System Self-paced Lecture (33:08)", "link": "https://acr.instructure.com/courses/411/assignments/37713" },
  { "id": 23, "date": "October 22", "title": "NM 202 PET/CT Imaging: Oncologic Applications Self-paced Lecture (53:25)", "link": "https://acr.instructure.com/courses/411/assignments/37707" },
  { "id": 24, "date": "October 22", "title": "MS 217 Acute Shoulder Instability Self-paced Lecture (28:51)", "link": "https://acr.instructure.com/courses/411/assignments/37690" },
  { "id": 25, "date": "October 22", "title": "MS 214 Radiologic Evaluation of Musculoskeletal Infection Self-paced Lecture (35:42)", "link": "https://acr.instructure.com/courses/411/assignments/37689" },
  { "id": 26, "date": "October 22", "title": "MS 205 Rheumatologic Joint Disease Self-paced Lecture (42:53)", "link": "https://acr.instructure.com/courses/411/assignments/37712" },
  { "id": 27, "date": "October 23", "title": "NM 201 SPECT/CT Imaging: Oncologic, Non-oncologic and Musculoskeletal Applications Self-paced Lecture (46:11)", "link": "https://acr.instructure.com/courses/411/assignments/37706" },
  { "id": 28, "date": "October 23", "title": "MS 108 Imaging of the Spine Self-paced Lecture (44:17)", "link": "https://acr.instructure.com/courses/411/assignments/37711" },
  { "id": 29, "date": "October 23", "title": "MS 109 Imaging of Trauma to the Skeleton Self-paced Lecture (35:47)", "link": "https://acr.instructure.com/courses/411/assignments/37705" },
  { "id": 30, "date": "October 23", "title": "MS 107 Arthritis and Arthropathies Self-paced Lecture (31:58)", "link": "https://acr.instructure.com/courses/411/assignments/37704" },
  { "id": 31, "date": "November 3", "title": "BI 104 Imaging the Augmented Breast Self-paced Lecture (36:38)", "link": "https://acr.instructure.com/courses/411/assignments/38033" },
  { "id": 32, "date": "November 3", "title": "BI 106 Clinical Cases in Breast MRI Self-paced Lecture (29:25)", "link": "https://acr.instructure.com/courses/411/assignments/38035" },
  { "id": 33, "date": "November 3", "title": "BI 107 Practical Breast MRI Reporting Self-paced Lecture (30:34)", "link": "https://acr.instructure.com/courses/411/assignments/38036" },
  { "id": 34, "date": "November 3", "title": "BI 205 Advanced Problem Solving: Asymmetries, Distortions and Masses Self-paced Lecture (32:15)", "link": "https://acr.instructure.com/courses/411/assignments/38027" },
  { "id": 35, "date": "November 4", "title": "BI 110 MRI of the Breast: DCE, DW, ASL and Other Advanced Techniques Self-paced Lecture (29:21)", "link": "https://acr.instructure.com/courses/411/assignments/38038" },
  { "id": 36, "date": "November 4", "title": "BI 101 Detecting Breast Cancer: Key Concepts for the Screening Breast Imager Self-paced Lecture (32:03)", "link": "https://acr.instructure.com/courses/411/assignments/38032" },
  { "id": 37, "date": "November 4", "title": "BI 102 Diagnostic Evaluation of the Symptomatic Patient Self-paced Lecture (34:57)", "link": "https://acr.instructure.com/courses/411/assignments/38039" },
  { "id": 38, "date": "November 4", "title": "BI 103 Diagnostic Imaging Following a Positive Screening Exam Self-paced Lecture (37:34)", "link": "https://acr.instructure.com/courses/411/assignments/38034" },
  { "id": 39, "date": "November 5", "title": "BI 206 Advanced Problem Solving: Calcifications Self-paced Lecture (35:46)", "link": "https://acr.instructure.com/courses/411/assignments/38028" },
  { "id": 40, "date": "November 6", "title": "BI 105 Interventional Breast Procedures: Pre-procedural Imaging and Planning Self-paced Lecture (33:01)", "link": "https://acr.instructure.com/courses/411/assignments/38037" },
  { "id": 41, "date": "November 6", "title": "BI 108 Mammography and Digital Breast Tomosynthesis: High Risk and Screening Strategies Self-paced Lecture (35:11)", "link": "https://acr.instructure.com/courses/411/assignments/38040" },
  { "id": 42, "date": "November 7", "title": "BI 211 DCIS: MRI Self-paced Lecture (23:15)", "link": "https://acr.instructure.com/courses/411/assignments/38041" },
  { "id": 43, "date": "November 7", "title": "BI 203 Breast Diseases in Young Women Self-paced Lecture (27:10)", "link": "https://acr.instructure.com/courses/411/assignments/38030" },
  { "id": 44, "date": "November 7", "title": "BI 204 Breast Disease in Males Self-paced Lecture (21:30)", "link": "https://acr.instructure.com/courses/411/assignments/38031" }
];

const STORAGE_KEY = "airpSelfPacedProgress_v1";
let progress = loadProgress();
let currentFilter = "all";
let expandAll = false;

function loadProgress() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : {};
  } catch {
    return {};
  }
}
function saveProgress(p) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(p));
}

function ensureProgressSkeleton() {
  LECTURES.forEach(l => {
    if (!progress[l.id]) {
      progress[l.id] = { watched: false, attendance: false, cards: 0 };
    }
  });
}
ensureProgressSkeleton();

function emojiFor(title) {
  if (title.startsWith("NR ")) return "ðŸ§ ðŸ“¡";
  if (title.startsWith("NM ")) return "ðŸ§¬ðŸ“·";
  if (title.startsWith("PE ")) return "ðŸ§’ðŸ«";
  if (title.startsWith("MS ")) return "ðŸ¦´ðŸƒ";
  if (title.startsWith("BI ")) return "ðŸŽ€ðŸ©»";
  return "ðŸ“º";
}

function render() {
  const list = document.getElementById("lectureList");
  list.innerHTML = "";
  LECTURES.forEach(lec => {
    const p = progress[lec.id];
    // filter
    if (currentFilter === "needWatch" && p.watched) return;
    if (currentFilter === "needCards" && p.cards >= 10) return;

    const allDone = p.watched && p.attendance && p.cards >= 10;

    const card = document.createElement("div");
    card.className = "lecture-card" + (allDone ? " done-all" : "");
    card.dataset.id = lec.id;
    card.dataset.expanded = expandAll ? "true" : "false";

    // header
    const header = document.createElement("div");
    header.className = "lecture-header";

    const emojiEl = document.createElement("div");
    emojiEl.className = "emoji-block";
    emojiEl.textContent = emojiFor(lec.title);

    const textWrap = document.createElement("div");
    textWrap.className = "header-text";

    const titleEl = document.createElement("div");
    titleEl.className = "lecture-title";
    titleEl.textContent = lec.title;

    const meta = document.createElement("div");
    meta.className = "lecture-meta";

    const date = document.createElement("span");
    date.className = "badge-date";
    date.textContent = lec.date;
    meta.appendChild(date);

    const dots = document.createElement("div");
    dots.className = "status-dots";
    const dot1 = document.createElement("span");
    dot1.className = "st-dot" + (p.watched ? " st-done" : "");
    const dot2 = document.createElement("span");
    dot2.className = "st-dot" + (p.attendance ? " st-done" : "");
    const dot3 = document.createElement("span");
    dot3.className = "st-dot" + (p.cards >= 10 ? " st-done" : "");
    dots.append(dot1, dot2, dot3);
    meta.appendChild(dots);

    textWrap.appendChild(titleEl);
    textWrap.appendChild(meta);

    const chevron = document.createElement("div");
    chevron.className = "expand-indicator";
    chevron.textContent = "â€º";

    header.append(emojiEl, textWrap, chevron);
    card.appendChild(header);

    // body
    const body = document.createElement("div");
    body.className = "lecture-body";
    const inner = document.createElement("div");
    inner.className = "lecture-body-inner";

    const tag = document.createElement("div");
    if (allDone) {
      tag.className = "tag-status";
      tag.textContent = "Done âœ“";
      inner.appendChild(tag);
    }

    const link = document.createElement("div");
    link.className = "link-line";
    const a = document.createElement("a");
    a.href = lec.link;
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.textContent = lec.link;
    link.appendChild(a);
    inner.appendChild(link);

    const checklist = document.createElement("div");
    checklist.className = "checklist";

    const makeChk = (label, key) => {
      const l = document.createElement("label");
      l.className = "chk";
      const input = document.createElement("input");
      input.type = "checkbox";
      input.checked = !!p[key];
      input.addEventListener("click", ev => {
        ev.stopPropagation();
      });
      input.addEventListener("change", () => {
        progress[lec.id][key] = input.checked;
        saveProgress(progress);
        render();
      });
      const span = document.createElement("span");
      span.textContent = label;
      l.append(input, span);
      return l;
    };
    checklist.appendChild(makeChk("Watched", "watched"));
    checklist.appendChild(makeChk("Attendance", "attendance"));
    inner.appendChild(checklist);

    const cardsRow = document.createElement("div");
    cardsRow.className = "cards-row";

    const pill = document.createElement("span");
    pill.className = "cards-pill";
    pill.textContent = "Cards: " + (p.cards || 0) + "/10";
    cardsRow.appendChild(pill);

    const minus = document.createElement("button");
    minus.textContent = "âˆ’";
    minus.addEventListener("click", ev => {
      ev.stopPropagation();
      const cur = progress[lec.id].cards || 0;
      progress[lec.id].cards = Math.max(0, cur - 1);
      saveProgress(progress);
      render();
    });
    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.addEventListener("click", ev => {
      ev.stopPropagation();
      const cur = progress[lec.id].cards || 0;
      progress[lec.id].cards = Math.min(30, cur + 1);
      saveProgress(progress);
      render();
    });
    const ten = document.createElement("button");
    ten.textContent = "10";
    ten.title = "Mark 10 cards made";
    ten.addEventListener("click", ev => {
      ev.stopPropagation();
      progress[lec.id].cards = 10;
      saveProgress(progress);
      render();
    });

    cardsRow.append(minus, plus, ten);
    inner.appendChild(cardsRow);

    body.appendChild(inner);
    card.appendChild(body);

    header.addEventListener("click", () => {
      const isOpen = card.dataset.expanded === "true";
      card.dataset.expanded = isOpen ? "false" : "true";
    });

    list.appendChild(card);
  });
}

document.querySelectorAll(".filter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.filter;
    render();
  });
});

const prefsBtn = document.getElementById("prefsBtn");
const prefsPanel = document.getElementById("prefsPanel");
prefsBtn.addEventListener("click", () => {
  prefsPanel.style.display = prefsPanel.style.display === "block" ? "none" : "block";
});

document.getElementById("downloadBtn").addEventListener("click", () => {
  const blob = new Blob([JSON.stringify(progress, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "airp-self-paced-progress.json";
  a.click();
  URL.revokeObjectURL(url);
  document.getElementById("prefsStatus").textContent = "Downloaded.";
  setTimeout(() => document.getElementById("prefsStatus").textContent = "", 4000);
});

document.getElementById("uploadInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);
      LECTURES.forEach(l => {
        if (!data[l.id]) data[l.id] = { watched: false, attendance: false, cards: 0 };
      });
      progress = data;
      saveProgress(progress);
      render();
      document.getElementById("prefsStatus").textContent = "Imported successfully.";
    } catch (err) {
      document.getElementById("prefsStatus").textContent = "Import failed.";
    }
    setTimeout(() => document.getElementById("prefsStatus").textContent = "", 4000);
  };
  reader.readAsText(file);
});

document.getElementById("expandToggle").addEventListener("click", () => {
  expandAll = !expandAll;
  // re-render with new state
  render();
});

render();
</script>
</body>
</html>
